!function(){"use strict";var element=document.createElement("div");element.id="darkroom-icons",element.style.height=0,element.style.width=0,element.style.position="absolute",element.style.visibility="hidden",element.innerHTML='<!-- inject:svg --><svg xmlns="http://www.w3.org/2000/svg"><defs><filter id="a" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:label="Noise fill" inkscape:menu="ABCs" inkscape:menu-tooltip="Basic noise fill texture; adjust color in Flood" color-interpolation-filters="sRGB"><feTurbulence numOctaves="5" baseFrequency=".02" type="fractalNoise"/><feColorMatrix result="result0" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 3 -1"/><feFlood flood-opacity="1" flood-color="#91c7c3" result="result1"/><feBlend in2="SourceGraphic" in="result1"/><feComposite operator="out" in2="result0"/><feComposite operator="atop" in2="SourceGraphic"/></filter></defs><symbol id="blur"><rect width="100%" height="100%" fill="none"/><g class="currentLayer"><title>Layer 1</title><g stroke-dasharray="5,5" filter="url(#a)"><circle cx="8.5" cy="8.501" r="2.5" filter="url(#a)"/><path d="M16 10c-2 0-3 3-4.5 3s-1.499-1-3.5-1c-2 0-3.001 4-3.001 4H19s-1-6-3-6z" filter="url(#a)"/><path d="M20 3H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zm0 14H4V5h16v12z" filter="url(#a)"/></g></g></symbol><symbol id="canny"><rect width="100%" height="100%" fill="none"/><g class="currentLayer"><title>Layer 1</title><path fill="none" stroke="#fff" class="selected" stroke-width="2" color="#000" d="M2 2h18v19.774H2z"/><path fill="none" stroke="#fff" stroke-width="2" color="#000" d="M7 5h5v7H7zM9 14h6v4H9z"/></g></symbol><symbol id="close" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/><path d="M0 0h24v24H0z" fill="none"/></symbol><symbol id="crop" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"/></symbol><symbol id="done" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></symbol><symbol id="equalize"><rect width="100%" height="100%" fill="none"/><g class="currentLayer"><title>Layer 1</title><path d="M1.456 22.288H23.29v1.486H0V0h1.456v4.458H2.91v1.486H1.456v2.971H2.91v1.486H1.456v2.972H2.91v1.486H1.456v2.972H2.91v1.486H1.456v2.971zm2.91-6.686c0-1.23.978-2.229 2.184-2.229.227 0 .44.046.648.11l1.903-2.591a2.252 2.252 0 0 1-.367-1.234c0-1.23.979-2.229 2.183-2.229 1.206 0 2.184.999 2.184 2.23 0 .232-.045.449-.109.66l2.538 1.943a2.16 2.16 0 0 1 1.21-.375c.09 0 .176.016.263.028l2.533-5.17c-.379-.401-.615-.944-.615-1.544 0-1.23.98-2.23 2.184-2.23 1.205 0 2.183 1 2.183 2.23s-.978 2.228-2.183 2.228c-.091 0-.176-.015-.264-.027l-2.532 5.17c.38.4.613.944.613 1.544 0 1.23-.978 2.229-2.184 2.229-1.204 0-2.183-1-2.183-2.23 0-.23.045-.448.107-.66l-2.537-1.942a2.153 2.153 0 0 1-1.21.374c-.227 0-.439-.045-.646-.11l-1.903 2.59c.229.355.366.778.366 1.235 0 1.23-.977 2.229-2.183 2.229s-2.183-1-2.182-2.23zM20.38 5.2c0 .41.325.743.728.743.403 0 .728-.333.728-.743s-.325-.743-.728-.743a.735.735 0 0 0-.728.743zm-4.367 8.915c0 .41.325.743.728.743.403 0 .728-.332.728-.743s-.325-.743-.728-.743a.735.735 0 0 0-.728.743zM10.19 9.658c0 .411.325.743.727.743.404 0 .728-.332.728-.743s-.324-.743-.728-.743a.735.735 0 0 0-.727.743zm-4.367 5.944c0 .41.325.743.727.743.404 0 .728-.332.728-.743s-.324-.743-.728-.743a.735.735 0 0 0-.727.743z" class="selected" stroke="#fff" fill="#fff"/></g></symbol><symbol id="gray"><path fill="grey" d="M0 0h24v24H0z"/></symbol><symbol id="redo" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16a8.002 8.002 0 0 1 7.6-5.5c1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/></symbol><symbol id="rotate-left" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M7.11 8.53L5.7 7.11C4.8 8.27 4.24 9.61 4.07 11h2.02c.14-.87.49-1.72 1.02-2.47zM6.09 13H4.07c.17 1.39.72 2.73 1.62 3.89l1.41-1.42c-.52-.75-.87-1.59-1.01-2.47zm1.01 5.32c1.16.9 2.51 1.44 3.9 1.61V17.9c-.87-.15-1.71-.49-2.46-1.03L7.1 18.32zM13 4.07V1L8.45 5.55 13 10V6.09c2.84.48 5 2.94 5 5.91s-2.16 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93s-3.05-7.44-7-7.93z"/></symbol><symbol id="rotate-right" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M15.55 5.55L11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11a7.906 7.906 0 0 0-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42l1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z"/></symbol><symbol id="save" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></symbol><symbol id="sobel"><rect width="100%" height="100%" fill="none"/><g class="currentLayer"><title>Layer 1</title><path fill="#f2eaea" stroke="#fff" class="selected" stroke-width="2" color="#000" d="M2 2h18v19.774H2z"/><path fill="none" stroke="#fff" stroke-width="2" color="#000" d="M7 5h5v7H7zM9 14h6v4H9z"/></g></symbol><symbol id="undo" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/></symbol></svg><!-- endinject -->',document.body.appendChild(element)}(),function(){"use strict";function Darkroom(element,options,plugins){return this.constructor(element,options,plugins)}window.Darkroom=Darkroom,Darkroom.plugins=[],Darkroom.prototype={containerElement:null,canvas:null,image:null,sourceCanvas:null,sourceImage:null,originalImageElement:null,transformations:[],defaults:{minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,ratio:null,backgroundColor:"#fff",plugins:{},initialize:function(){}},plugins:{},options:{},constructor:function(element,options,plugins){if(this.options=Darkroom.Utils.extend(options,this.defaults),"string"==typeof element&&(element=document.querySelector(element)),null!==element){var image=new Image;image.onload=function(){this._initializeDOM(element),this._initializeImage(),this._initializePlugins(Darkroom.plugins),this.refresh(function(){this.options.initialize.bind(this).call()}.bind(this))}.bind(this),image.src=element.src}},selfDestroy:function(){var container=this.containerElement,image=new Image;image.onload=function(){container.parentNode.replaceChild(image,container)},image.src=this.sourceImage.toDataURL()},addEventListener:function(eventName,callback){var el=this.canvas.getElement();el.addEventListener?el.addEventListener(eventName,callback):el.attachEvent&&el.attachEvent("on"+eventName,callback)},dispatchEvent:function(eventName){var event=document.createEvent("Event");event.initEvent(eventName,!0,!0),this.canvas.getElement().dispatchEvent(event)},refresh:function(next){var clone=new Image;clone.onload=function(){this._replaceCurrentImage(new fabric.Image(clone)),next&&next()}.bind(this),clone.src=this.sourceImage.toDataURL()},_replaceCurrentImage:function(newImage){this.image&&this.image.remove(),this.image=newImage,this.image.selectable=!1;var viewport=Darkroom.Utils.computeImageViewPort(this.image),canvasWidth=viewport.width,canvasHeight=viewport.height;if(null!==this.options.ratio){var canvasRatio=+this.options.ratio,currentRatio=canvasWidth/canvasHeight;currentRatio>canvasRatio?canvasHeight=canvasWidth/canvasRatio:canvasRatio>currentRatio&&(canvasWidth=canvasHeight*canvasRatio)}var scaleMin=1,scaleMax=1,scaleX=1,scaleY=1;null!==this.options.maxWidth&&this.options.maxWidth<canvasWidth&&(scaleX=this.options.maxWidth/canvasWidth),null!==this.options.maxHeight&&this.options.maxHeight<canvasHeight&&(scaleY=this.options.maxHeight/canvasHeight),scaleMin=Math.min(scaleX,scaleY),scaleX=1,scaleY=1,null!==this.options.minWidth&&this.options.minWidth>canvasWidth&&(scaleX=this.options.minWidth/canvasWidth),null!==this.options.minHeight&&this.options.minHeight>canvasHeight&&(scaleY=this.options.minHeight/canvasHeight),scaleMax=Math.max(scaleX,scaleY);var scale=scaleMax*scaleMin;canvasWidth*=scale,canvasHeight*=scale,this.image.setScaleX(1*scale),this.image.setScaleY(1*scale),this.canvas.add(this.image),this.canvas.setWidth(canvasWidth),this.canvas.setHeight(canvasHeight),this.canvas.centerObject(this.image),this.image.setCoords()},applyTransformation:function(transformation){this.transformations.push(transformation),transformation.applyTransformation(this.sourceCanvas,this.sourceImage,this._postTransformation.bind(this))},_postTransformation:function(newImage){newImage&&(this.sourceImage=newImage),this.refresh(function(){this.dispatchEvent("core:transformation")}.bind(this))},reinitializeImage:function(){this.sourceImage.remove(),this._initializeImage(),this._popTransformation(this.transformations.slice())},_popTransformation:function(transformations){if(0===transformations.length)return this.dispatchEvent("core:reinitialized"),void this.refresh();var transformation=transformations.shift(),next=function(newImage){newImage&&(this.sourceImage=newImage),this._popTransformation(transformations)};transformation.applyTransformation(this.sourceCanvas,this.sourceImage,next.bind(this))},_initializeDOM:function(imageElement){var mainContainerElement=document.createElement("div");mainContainerElement.className="darkroom-container";var toolbarElement=document.createElement("div");toolbarElement.className="darkroom-toolbar",mainContainerElement.appendChild(toolbarElement);var canvasContainerElement=document.createElement("div");canvasContainerElement.className="darkroom-image-container";var canvasElement=document.createElement("canvas");canvasContainerElement.appendChild(canvasElement),mainContainerElement.appendChild(canvasContainerElement);var sourceCanvasContainerElement=document.createElement("div");sourceCanvasContainerElement.className="darkroom-source-container",sourceCanvasContainerElement.style.display="none";var sourceCanvasElement=document.createElement("canvas");sourceCanvasContainerElement.appendChild(sourceCanvasElement),mainContainerElement.appendChild(sourceCanvasContainerElement),imageElement.parentNode.replaceChild(mainContainerElement,imageElement),imageElement.style.display="none",mainContainerElement.appendChild(imageElement),this.containerElement=mainContainerElement,this.originalImageElement=imageElement,this.toolbar=new Darkroom.UI.Toolbar(toolbarElement),this.canvas=new fabric.Canvas(canvasElement,{selection:!1,backgroundColor:this.options.backgroundColor}),this.sourceCanvas=new fabric.Canvas(sourceCanvasElement,{selection:!1,backgroundColor:this.options.backgroundColor})},_initializeImage:function(){this.sourceImage=new fabric.Image(this.originalImageElement,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),this.sourceCanvas.add(this.sourceImage);var viewport=Darkroom.Utils.computeImageViewPort(this.sourceImage),canvasWidth=viewport.width,canvasHeight=viewport.height;this.sourceCanvas.setWidth(canvasWidth),this.sourceCanvas.setHeight(canvasHeight),this.sourceCanvas.centerObject(this.sourceImage),this.sourceImage.setCoords()},_initializePlugins:function(plugins){for(var name in plugins){var plugin=plugins[name],options=this.options.plugins[name];options!==!1&&plugins.hasOwnProperty(name)&&(this.plugins[name]=new plugin(this,options))}}}}();var jsfeat=jsfeat||{REVISION:"ALPHA"};!function(r){var o=1.192092896e-7,l=1e-37,m=256,i=512,h=1024,x=2048,w=4096,A=1,n=2,b=3,p=4,z=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),y=function(){return function(B){return 65280&B}}(),k=function(){return function(B){return 255&B}}(),c=function(){return function(B){return z[(65280&B)>>8]}}(),a=0,f=1,e=2,u=3,d=1,s=1,g=2,v=function(){function B(D,C){this.size=-8&(D+7|0),"undefined"==typeof C?this.buffer=new ArrayBuffer(this.size):(this.buffer=C,this.size=C.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}return B}(),q=function(){function B(F,D,E,C){this.type=0|y(E),this.channel=0|k(E),this.cols=0|F,this.rows=0|D,"undefined"==typeof C?this.allocate():(this.buffer=C,this.data=this.type&m?this.buffer.u8:this.type&i?this.buffer.i32:this.type&h?this.buffer.f32:this.buffer.f64)}return B.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new v(this.cols*c(this.type)*this.channel*this.rows),this.data=this.type&m?this.buffer.u8:this.type&i?this.buffer.i32:this.type&h?this.buffer.f32:this.buffer.f64},B.prototype.copy_to=function(D){for(var C=D.data,G=this.data,E=0,F=this.cols*this.rows*this.channel|0;F-4>E;E+=4)C[E]=G[E],C[E+1]=G[E+1],C[E+2]=G[E+2],C[E+3]=G[E+3];for(;F>E;++E)C[E]=G[E]},B.prototype.resize=function(F,D,C){"undefined"==typeof C&&(C=this.channel);var E=F*c(this.type)*C*D;E>this.buffer.size?(this.cols=F,this.rows=D,this.channel=C,this.allocate()):(this.cols=F,this.rows=D,this.channel=C)},B}(),t=function(){function B(C){this.levels=0|C,this.data=new Array(C),this.pyrdown=jsfeat.imgproc.pyrdown}return B.prototype.allocate=function(C,E,F){for(var D=this.levels;--D>=0;)this.data[D]=new q(C>>D,E>>D,F)},B.prototype.build=function(F,E){"undefined"==typeof E&&(E=!0);var H=2,D=F,C=this.data[0];if(!E)for(var G=F.cols*F.rows;--G>=0;)C.data[G]=F.data[G];for(C=this.data[1],this.pyrdown(D,C);H<this.levels;++H)D=C,C=this.data[H],this.pyrdown(D,C)},B}(),j=function(){function B(C,G,E,F,D){"undefined"==typeof C&&(C=0),"undefined"==typeof G&&(G=0),"undefined"==typeof E&&(E=0),"undefined"==typeof F&&(F=0),"undefined"==typeof D&&(D=-1),this.x=C,this.y=G,this.score=E,this.level=F,this.angle=D}return B}();r.U8_t=m,r.S32_t=i,r.F32_t=h,r.S64_t=x,r.F64_t=w,r.C1_t=A,r.C2_t=n,r.C3_t=b,r.C4_t=p,r.U8C1_t=m|A,r.U8C3_t=m|b,r.U8C4_t=m|p,r.F32C1_t=h|A,r.F32C2_t=h|n,r.S32C1_t=i|A,r.S32C2_t=i|n,r.EPSILON=o,r.FLT_MIN=l,r.COLOR_RGBA2GRAY=a,r.COLOR_RGB2GRAY=f,r.COLOR_BGRA2GRAY=e,r.COLOR_BGR2GRAY=u,r.BOX_BLUR_NOSCALE=d,r.SVD_U_T=s,r.SVD_V_T=g,r.get_data_type=y,r.get_channel=k,r.get_data_type_size=c,r.data_t=v,r.matrix_t=q,r.pyramid_t=t,r.keypoint_t=j}(jsfeat),function(b){var a=function(){var e,c,f=function(){function g(h){this.next=null,this.data=new jsfeat.data_t(h),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return g.prototype.resize=function(h){delete this.data,this.data=new jsfeat.data_t(h),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},g}(),d=0;return{allocate:function(g,k){e=c=new f(k);for(var h=0;g>h;++h){var j=new f(k);c=c.next=j,d++}},get_buffer:function(g){var h=e;return e=e.next,d--,g>h.size&&h.resize(g),h},put_buffer:function(g){c=c.next=g,d++}}}();b.cache=a,a.allocate(30,2560)}(jsfeat),function(b){var a=function(){var c=new Int32Array(96);return{get_gaussian_kernel:function(p,m,e,l){var f=0,j=0,o=0,n=0,d=0,g=0,h=jsfeat.cache.get_buffer(p<<2),k=h.f32;if(1==(1&p)&&7>=p&&0>=m)switch(p>>1){case 0:k[0]=1,g=1;break;case 1:k[0]=.25,k[1]=.5,k[2]=.25,g=1;break;case 2:k[0]=.0625,k[1]=.25,k[2]=.375,k[3]=.25,k[4]=.0625,g=1;break;case 3:k[0]=.03125,k[1]=.109375,k[2]=.21875,k[3]=.28125,k[4]=.21875,k[5]=.109375,k[6]=.03125,g=1}else for(n=m>0?m:.3*(.5*(p-1)-1)+.8,d=-.5/(n*n);p>f;++f)j=f-.5*(p-1),o=Math.exp(d*j*j),k[f]=o,g+=o;if(l&jsfeat.U8_t)for(g=256/g,f=0;p>f;++f)e[f]=k[f]*g+.5|0;else for(g=1/g,f=0;p>f;++f)e[f]=k[f]*g;jsfeat.cache.put_buffer(h)},perspective_4point_transform:function(x,B,r,w,g,A,q,v,f,z,p,u,e,y,o,t,d){var Y=B,X=z,W=q,V=Y*X*W,U=o,T=Y*U,S=X*T,R=p,n=Y*R,m=A,k=r,j=y,i=k*j,h=i*m,ax=j*m*R,aw=j*W,aq=j*R,ao=X*W,am=U*X,aj=U*m,ag=R*m,Q=1/(aw-aq-ao+am-aj+ag),O=Y*j,N=k*m,M=W*Y,L=U*M,K=k*X,I=i*R,G=k*R*m,D=W*U*X,C=U*k,av=-(S-V+n*m-m*T-i*X+h-ax+aw*X)*Q,au=(V-S-O*W+O*R+h-X*N+aj*X-ax)*Q,ar=Y,ap=(-R*T+L+K*W-i*W+I-G+aj*R-D)*Q,an=(-L+M*R-C*X+I-G+C*m+D-aw*R)*Q,al=k,ai=(-n+M+K-N+aq-aw-am+aj)*Q,af=(-T+n+i-K+aj-ag-aw+ao)*Q;Y=w,X=u,W=f,V=Y*X*W,U=d,T=Y*U,S=X*T,R=e,n=Y*R,m=v,k=g,j=t,i=k*j,h=i*m,ax=j*m*R,aw=j*W,aq=j*R,ao=X*W,am=U*X,aj=U*m,ag=R*m,Q=1/(aw-aq-ao+am-aj+ag),O=Y*j,N=k*m,M=W*Y,L=U*M,K=k*X,I=i*R,G=k*R*m,D=W*U*X,C=U*k;var ak=-(S-V+n*m-m*T-i*X+h-ax+aw*X)*Q,ah=(V-S-O*W+O*R+h-X*N+aj*X-ax)*Q,ae=Y,ad=(-R*T+L+K*W-i*W+I-G+aj*R-D)*Q,ac=(-L+M*R-C*X+I-G+C*m+D-aw*R)*Q,ab=k,aa=(-n+M+K-N+aq-aw-am+aj)*Q,Z=(-T+n+i-K+aj-ag-aw+ao)*Q;X=an-af*al,W=av*an,V=av*al,T=ap*au,S=ar*ap,n=au*ai;var l=ar*ai;j=1/(W-V*af-T+S*af+n*al-l*an),h=-ap+al*ai;var at=-ap*af+an*ai;ag=-au+ar*af;var P=av-l;N=av*af-n,M=-au*al+ar*an;var J=V-S,H=W-T;G=X*j;var F=ag*j,E=M*j,s=x.data;s[0]=ak*G+ah*(h*j)-ae*(at*j),s[1]=ak*F+ah*(P*j)-ae*(N*j),s[2]=-ak*E-ah*(J*j)+ae*(H*j),s[3]=ad*G+ac*(h*j)-ab*(at*j),s[4]=ad*F+ac*(P*j)-ab*(N*j),s[5]=-ad*E-ac*(J*j)+ab*(H*j),s[6]=aa*G+Z*(h*j)-at*j,s[7]=aa*F+Z*(P*j)-N*j,s[8]=-aa*E-Z*(J*j)+H*j},qsort:function(o,J,s,u){var v,r,q,p,D=7,C=0,j=0,G=0,B=0,z=0,A=0,e=0,y=0,E=0,x=0,w=0,h=0,g=0,l=0,I=0,H=0,F=0,f=0,k=c;if(!(1>=s-J+1))for(k[0]=J,k[1]=s;C>=0;)for(j=k[C<<1],G=k[(C<<1)+1],C--;;){if(z=G-j+1,D>=z){for(e=j+1;G>=e;e++)for(y=e;y>j&&u(o[y],o[y-1]);y--)v=o[y],o[y]=o[y-1],o[y-1]=v;break}for(f=0,x=j,h=G,l=j+(z>>1),z>40&&(E=z>>3,I=j,H=j+E,F=j+(E<<1),r=o[I],q=o[H],p=o[F],j=u(r,q)?u(q,p)?H:u(r,p)?F:I:u(p,q)?H:u(r,p)?I:F,I=l-E,H=l,F=l+E,r=o[I],q=o[H],p=o[F],l=u(r,q)?u(q,p)?H:u(r,p)?F:I:u(p,q)?H:u(r,p)?I:F,I=G-(E<<1),H=G-E,F=G,r=o[I],q=o[H],p=o[F],G=u(r,q)?u(q,p)?H:u(r,p)?F:I:u(p,q)?H:u(r,p)?I:F),I=j,H=l,F=G,r=o[I],q=o[H],p=o[F],l=u(r,q)?u(q,p)?H:u(r,p)?F:I:u(p,q)?H:u(r,p)?I:F,l!=x&&(v=o[l],o[l]=o[x],o[x]=v,l=x),j=w=x+1,G=g=h,r=o[l];;){for(;G>=j&&!u(r,o[j]);)u(o[j],r)||(j>w&&(v=o[w],o[w]=o[j],o[j]=v),f=1,w++),j++;for(;G>=j&&!u(o[G],r);)u(r,o[G])||(g>G&&(v=o[g],o[g]=o[G],o[G]=v),f=1,g--),G--;if(j>G)break;v=o[j],o[j]=o[G],o[G]=v,f=1,j++,G--}if(0==f){for(j=x,G=h,e=j+1;G>=e;e++)for(y=e;y>j&&u(o[y],o[y-1]);y--)v=o[y],o[y]=o[y-1],o[y-1]=v;break}for(z=Math.min(w-x,j-w),A=j-z|0,B=0;z>B;++B,++A)v=o[x+B],o[x+B]=o[A],o[A]=v;for(z=Math.min(h-g,g-G),A=h-z+1|0,B=0;z>B;++B,++A)v=o[j+B],o[j+B]=o[A],o[A]=v;if(z=j-w,A=g-G,z>1)A>1?z>A?(++C,k[C<<1]=x,k[(C<<1)+1]=x+z-1,j=h-A+1,G=h):(++C,k[C<<1]=h-A+1,k[(C<<1)+1]=h,j=x,G=x+z-1):(j=x,G=x+z-1);else{if(!(A>1))break;j=h-A+1,G=h}}},median:function(k,d,i){for(var e,f=0,j=0,g=0,h=d+i>>1;;){if(d>=i)return k[h];if(i==d+1)return k[d]>k[i]&&(e=k[d],k[d]=k[i],k[i]=e),k[h];for(f=d+i>>1,k[f]>k[i]&&(e=k[f],k[f]=k[i],k[i]=e),k[d]>k[i]&&(e=k[d],k[d]=k[i],k[i]=e),k[f]>k[d]&&(e=k[f],k[f]=k[d],k[d]=e),j=d+1,e=k[f],k[f]=k[j],k[j]=e,g=i;;){do++j;while(k[d]>k[j]);do--g;while(k[g]>k[d]);if(j>g)break;e=k[j],k[j]=k[g],k[g]=e}e=k[d],k[d]=k[g],k[g]=e,h>=g?d=j:g>=h&&(i=g-1)}return 0}}}();b.math=a}(jsfeat),function(b){var a=function(){return{identity:function(j,g){"undefined"==typeof g&&(g=1);for(var i=j.data,f=j.rows,h=j.cols,e=h+1|0,c=f*h,d=c;--c>=0;)i[c]=0;for(c=d,d=0;c>d;)i[d]=g,d+=e},transpose:function(f,d){for(var l=0,h=0,k=d.rows,c=d.cols,n=0,e=0,m=0,o=d.data,g=f.data;k>l;e+=1,n+=c,l++)for(m=e,h=0;c>h;m+=k,h++)g[m]=o[n+h]},multiply:function(l,n,m){for(var u=0,s=0,o=0,r=0,t=0,q=0,w=0,g=0,f=n.cols,e=n.rows,p=m.cols,v=n.data,d=m.data,h=l.data,c=0;e>u;r+=f,u++)for(w=0,s=0;p>s;g++,w++,s++){for(q=w,t=r,c=0,o=0;f>o;t++,q+=p,o++)c+=v[t]*d[q];h[g]=c}},multiply_ABt:function(c,g,d){for(var p=0,n=0,m=0,r=0,l=0,f=0,u=0,e=g.cols,o=g.rows,q=d.rows,v=g.data,t=d.data,h=c.data,s=0;o>p;r+=e,p++)for(f=0,n=0;q>n;u++,n++){for(l=r,s=0,m=0;e>m;l++,f++,m++)s+=v[l]*t[f];h[u]=s}},multiply_AtB:function(l,n,m){for(var u=0,s=0,o=0,r=0,t=0,q=0,w=0,g=0,f=n.cols,e=n.rows,p=m.cols,v=n.data,d=m.data,h=l.data,c=0;f>u;r++,u++)for(w=0,s=0;p>s;g++,w++,s++){for(q=w,t=r,c=0,o=0;e>o;t+=f,q+=p,o++)c+=v[t]*d[q];h[g]=c}},multiply_AAt:function(d,h){for(var q=0,o=0,n=0,c=0,r=0,m=0,g=0,e=0,u=0,f=h.cols,p=h.rows,t=h.data,l=d.data,s=0;p>q;c+=p+1,r=m,q++)for(e=c,u=c,g=r,o=q;p>o;e++,u+=p,o++){for(m=r,s=0,n=0;f>n;n++)s+=t[m++]*t[g++];l[e]=s,l[u]=s}},multiply_AtA:function(c,g){for(var r=0,p=0,n=0,s=0,m=0,f=0,o=0,d=0,l=0,e=g.cols,q=g.rows,u=g.data,h=c.data,t=0;e>r;o+=e,r++)for(s=r,l=o+r,d=l,p=r;e>p;d++,l+=e,p++){for(m=s,f=p,t=0,n=0;q>n;m+=e,f+=e,n++)t+=u[m]*u[f];h[d]=t,h[l]=t}},identity_3x3:function(e,d){"undefined"==typeof d&&(d=1);var c=e.data;c[0]=c[4]=c[8]=d,c[1]=c[2]=c[3]=0,c[5]=c[6]=c[7]=0},invert_3x3:function(s,e){var o=s.data,h=e.data,n=o[4],m=o[8],l=o[5],k=o[7],j=o[0],i=j*n,v=j*l,u=o[3],t=o[1],r=u*t,q=o[2],p=u*q,g=o[6],f=g*t,d=g*q,c=1/(i*m-v*k-r*m+p*k+f*l-d*n);h[0]=(n*m-l*k)*c,h[1]=-(t*m-q*k)*c,h[2]=-(-t*l+q*n)*c,h[3]=-(u*m-l*g)*c,h[4]=(j*m-d)*c,h[5]=-(v-p)*c,h[6]=-(-u*k+n*g)*c,h[7]=-(j*k-f)*c,h[8]=(i-r)*c},multiply_3x3:function(r,v,t){var y=r.data,z=v.data,l=t.data,x=z[0],w=z[1],u=z[2],s=z[3],q=z[4],p=z[5],o=z[6],n=z[7],m=z[8],k=l[0],j=l[1],i=l[2],h=l[3],g=l[4],f=l[5],e=l[6],d=l[7],c=l[8];y[0]=x*k+w*h+u*e,y[1]=x*j+w*g+u*d,y[2]=x*i+w*f+u*c,y[3]=s*k+q*h+p*e,y[4]=s*j+q*g+p*d,y[5]=s*i+q*f+p*c,y[6]=o*k+n*h+m*e,y[7]=o*j+n*g+m*d,y[8]=o*i+n*f+m*c},mat3x3_determinant:function(d){var c=d.data;return c[0]*c[4]*c[8]-c[0]*c[5]*c[7]-c[3]*c[1]*c[8]+c[3]*c[2]*c[7]+c[6]*c[1]*c[5]-c[6]*c[2]*c[4]},determinant_3x3:function(h,g,f,e,d,c,k,j,i){return h*d*i-h*c*j-e*g*i+e*f*j+k*g*c-k*f*d}}}();b.matmath=a}(jsfeat),function(b){var a=function(){var f=function(g,j,i,h){h=g[j],g[j]=g[i],g[i]=h},d=function(h,g){return h=Math.abs(h),g=Math.abs(g),h>g?(g/=h,h*Math.sqrt(1+g*g)):g>0?(h/=g,g*Math.sqrt(1+h*h)):0},c=function(H,o,q,r,h,I){var C=jsfeat.EPSILON,N=0,M=0,L=0,J=0,K=0,D=0,R=0,G=0,u=0,v=I*I*30,E=0,U=0,F=0,x=0,z=0,B=0,Q=0,T=0,w=0,P=jsfeat.cache.get_buffer(I<<2),S=jsfeat.cache.get_buffer(I<<2),O=P.i32,g=S.i32;if(r)for(;I>N;N++){for(L=N*h,M=0;I>M;M++)r[L+M]=0;r[L+N]=1}for(L=0;I>L;L++){if(q[L]=H[(o+1)*L],I-1>L){for(J=L+1,E=Math.abs(H[o*L+J]),N=L+2;I>N;N++)U=Math.abs(H[o*L+N]),U>E&&(E=U,J=N);O[L]=J}if(L>0){for(J=0,E=Math.abs(H[L]),N=1;L>N;N++)U=Math.abs(H[o*N+L]),U>E&&(E=U,J=N);g[L]=J}}if(I>1)for(;v>u;u++){for(L=0,E=Math.abs(H[O[0]]),N=1;I-1>N;N++)U=Math.abs(H[o*N+O[N]]),U>E&&(E=U,L=N);for(K=O[L],N=1;I>N;N++)U=Math.abs(H[o*g[N]+N]),U>E&&(E=U,L=g[N],K=N);if(F=H[o*L+K],Math.abs(F)<=C)break;for(x=.5*(q[K]-q[L]),z=Math.abs(x)+d(F,x),B=d(F,z),Q=z/B,B=F/B,z=F/z*F,0>x&&(B=-B,z=-z),H[o*L+K]=0,q[L]-=z,q[K]+=z,N=0;L>N;N++)R=o*N+L,G=o*N+K,T=H[R],w=H[G],H[R]=T*Q-w*B,H[G]=T*B+w*Q;for(N=L+1;K>N;N++)R=o*L+N,G=o*N+K,T=H[R],w=H[G],H[R]=T*Q-w*B,H[G]=T*B+w*Q;for(N=K+1,R=o*L+N,G=o*K+N;I>N;N++,R++,G++)T=H[R],w=H[G],H[R]=T*Q-w*B,H[G]=T*B+w*Q;if(r)for(R=h*L,G=h*K,N=0;I>N;N++,R++,G++)T=r[R],w=r[G],r[R]=T*Q-w*B,r[G]=T*B+w*Q;for(M=0;2>M;M++){if(D=0==M?L:K,I-1>D){for(J=D+1,E=Math.abs(H[o*D+J]),N=D+2;I>N;N++)U=Math.abs(H[o*D+N]),U>E&&(E=U,J=N);O[D]=J}if(D>0){for(J=0,E=Math.abs(H[D]),N=1;D>N;N++)U=Math.abs(H[o*N+D]),U>E&&(E=U,J=N);g[D]=J}}}for(L=0;I-1>L;L++){for(J=L,N=L+1;I>N;N++)q[J]<q[N]&&(J=N);if(L!=J&&(f(q,J,L,E),r))for(N=0;I>N;N++)f(r,h*J+N,h*L+N,E)}jsfeat.cache.put_buffer(P),jsfeat.cache.put_buffer(S)},e=function(D,l,h,M,v,T,S,E){for(var C=2*jsfeat.EPSILON,q=jsfeat.FLT_MIN,X=0,V=0,U=0,A=0,u=Math.max(T,30),K=0,J=0,R=0,Q=0,F=0,Y=0,O=0,N=0,H=0,G=0,x=0,I=0,w=0,L=0,aa=0,P=0,Z=0,z=4660,B=0,y=0,o=0,r=jsfeat.cache.get_buffer(S<<3),g=r.f64;S>X;X++){for(U=0,x=0;T>U;U++)N=D[X*l+U],x+=N*N;if(g[X]=x,M){for(U=0;S>U;U++)M[X*v+U]=0;M[X*v+X]=1}}for(;u>A;A++){for(F=0,X=0;S-1>X;X++)for(V=X+1;S>V;V++){for(K=X*l|0,J=V*l|0,aa=g[X],P=0,Z=g[V],U=2,P+=D[K]*D[J],P+=D[K+1]*D[J+1];T>U;U++)P+=D[K+U]*D[J+U];if(!(Math.abs(P)<=C*Math.sqrt(aa*Z))){for(P*=2,I=aa-Z,w=d(P,I),0>I?(L=.5*(w-I),O=Math.sqrt(L/w),Y=P/(w*O*2)):(Y=Math.sqrt((w+I)/(2*w)),O=P/(w*Y*2)),aa=0,Z=0,U=2,H=Y*D[K]+O*D[J],G=-O*D[K]+Y*D[J],D[K]=H,D[J]=G,aa+=H*H,Z+=G*G,H=Y*D[K+1]+O*D[J+1],G=-O*D[K+1]+Y*D[J+1],D[K+1]=H,D[J+1]=G,aa+=H*H,Z+=G*G;T>U;U++)H=Y*D[K+U]+O*D[J+U],G=-O*D[K+U]+Y*D[J+U],D[K+U]=H,D[J+U]=G,aa+=H*H,Z+=G*G;if(g[X]=aa,g[V]=Z,F=1,M)for(R=X*v|0,Q=V*v|0,U=2,H=Y*M[R]+O*M[Q],G=-O*M[R]+Y*M[Q],M[R]=H,M[Q]=G,H=Y*M[R+1]+O*M[Q+1],G=-O*M[R+1]+Y*M[Q+1],M[R+1]=H,M[Q+1]=G;S>U;U++)H=Y*M[R+U]+O*M[Q+U],G=-O*M[R+U]+Y*M[Q+U],M[R+U]=H,M[Q+U]=G}}if(0==F)break}for(X=0;S>X;X++){for(U=0,x=0;T>U;U++)N=D[X*l+U],x+=N*N;g[X]=Math.sqrt(x)}for(X=0;S-1>X;X++){for(V=X,U=X+1;S>U;U++)g[V]<g[U]&&(V=U);if(X!=V&&(f(g,X,V,x),M)){for(U=0;T>U;U++)f(D,X*l+U,V*l+U,N);for(U=0;S>U;U++)f(M,X*v+U,V*v+U,N)}}for(X=0;S>X;X++)h[X]=g[X];if(!M)return void jsfeat.cache.put_buffer(r);for(X=0;E>X;X++){for(x=S>X?g[X]:0;q>=x;){for(y=1/T,U=0;T>U;U++)z=214013*z+2531011,B=0!=(z>>16&32767&256)?y:-y,D[X*l+U]=B;for(A=0;2>A;A++)for(V=0;X>V;V++){for(x=0,U=0;T>U;U++)x+=D[X*l+U]*D[V*l+U];for(o=0,U=0;T>U;U++)N=D[X*l+U]-x*D[V*l+U],D[X*l+U]=N,o+=Math.abs(N);for(o=o?1/o:0,U=0;T>U;U++)D[X*l+U]*=o}for(x=0,U=0;T>U;U++)N=D[X*l+U],x+=N*N;x=Math.sqrt(x)}for(O=1/x,U=0;T>U;U++)D[X*l+U]*=O}jsfeat.cache.put_buffer(r)};return{lu_solve:function(l,g){var x,m,u,y,q=0,o=0,n=0,h=1,v=l.cols,w=l.data,r=g.data;for(q=0;v>q;q++){for(n=q,o=q+1;v>o;o++)Math.abs(w[o*v+q])>Math.abs(w[n*v+q])&&(n=o);if(Math.abs(w[n*v+q])<jsfeat.EPSILON)return 0;if(n!=q){for(o=q;v>o;o++)f(w,q*v+o,n*v+o,x);f(r,q,n,x),h=-h}for(u=-1/w[q*v+q],o=q+1;v>o;o++){for(m=w[o*v+q]*u,n=q+1;v>n;n++)w[o*v+n]+=m*w[q*v+n];r[o]+=m*r[q]}w[q*v+q]=-u}for(q=v-1;q>=0;q--){for(y=r[q],n=q+1;v>n;n++)y-=w[q*v+n]*r[n];r[q]=y*w[q*v+q]}return 1},cholesky_solve:function(h,g){var k,m,l=0,v=0,r=0,s=0,n=0,p=0,o=0,u=h.cols,t=h.data,q=g.data;for(l=0;u>l;l++)for(m=1,s=l*u,n=s,v=l;u>v;v++){for(k=t[n+l],r=0;l>r;r++)k-=t[r*u+l]*t[n+r];if(v==l){if(t[n+l]=k,0==k)return 0;m=1/k}else t[s+v]=k,t[n+l]=k*m;n+=u}for(s=0,p=0;u>p;p++){for(k=q[p],o=0;p>o;o++)k-=t[s+o]*q[o];q[p]=k,s+=u}for(s=0,p=0;u>p;p++)q[p]/=t[s+p],s+=u;for(p=u-1;p>=0;p--){for(k=q[p],o=p+1,s=o*u;u>o;o++)k-=t[s+p]*q[o],s+=u;q[p]=k}return 1},svd_decompose:function(t,k,p,l,o){"undefined"==typeof o&&(o=0);var r=0,z=0,g=t.rows,D=t.cols,w=g,v=D,s=t.type|jsfeat.C1_t;v>w&&(r=1,z=w,w=v,v=z);var q=jsfeat.cache.get_buffer(w*w<<3),h=jsfeat.cache.get_buffer(v<<3),C=jsfeat.cache.get_buffer(v*v<<3),u=new jsfeat.matrix_t(w,w,s,q.data),B=new jsfeat.matrix_t(1,v,s,h.data),y=new jsfeat.matrix_t(v,v,s,C.data);if(0==r)jsfeat.matmath.transpose(u,t);else{for(z=0;D*g>z;z++)u.data[z]=t.data[z];for(;v*w>z;z++)u.data[z]=0}if(e(u.data,w,B.data,y.data,v,w,v,w),k){for(z=0;v>z;z++)k.data[z]=B.data[z];for(;D>z;z++)k.data[z]=0}if(0==r){if(p&&o&jsfeat.SVD_U_T)for(z=w*w;--z>=0;)p.data[z]=u.data[z];else p&&jsfeat.matmath.transpose(p,u);if(l&&o&jsfeat.SVD_V_T)for(z=v*v;--z>=0;)l.data[z]=y.data[z];else l&&jsfeat.matmath.transpose(l,y)}else{if(p&&o&jsfeat.SVD_U_T)for(z=v*v;--z>=0;)p.data[z]=y.data[z];else p&&jsfeat.matmath.transpose(p,y);if(l&&o&jsfeat.SVD_V_T)for(z=w*w;--z>=0;)l.data[z]=u.data[z];else l&&jsfeat.matmath.transpose(l,u)}jsfeat.cache.put_buffer(q),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(C)},svd_solve:function(v,l,s){var E=0,C=0,z=0,w=0,u=0,o=v.rows,p=v.cols,h=0,I=0,x=0,r=v.type|jsfeat.C1_t,F=jsfeat.cache.get_buffer(o*o<<3),m=jsfeat.cache.get_buffer(p<<3),H=jsfeat.cache.get_buffer(p*p<<3),t=new jsfeat.matrix_t(o,o,r,F.data),G=new jsfeat.matrix_t(1,p,r,m.data),D=new jsfeat.matrix_t(p,p,r,H.data),n=s.data,y=t.data,q=G.data,g=D.data;for(this.svd_decompose(v,G,t,D,0),x=jsfeat.EPSILON*q[0]*p;p>E;E++,u+=p){for(I=0,C=0;p>C;C++)if(q[C]>x){for(z=0,h=0,w=0;o>z;z++,w+=p)h+=y[w+C]*n[z];I+=h*g[u+C]/q[C]}l.data[E]=I}jsfeat.cache.put_buffer(F),jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(H)},svd_invert:function(E,t){var C=0,z=0,y=0,v=0,s=0,h=0,n=t.rows,o=t.cols,l=0,w=0,q=t.type|jsfeat.C1_t,D=jsfeat.cache.get_buffer(n*n<<3),m=jsfeat.cache.get_buffer(o<<3),G=jsfeat.cache.get_buffer(o*o<<3),u=new jsfeat.matrix_t(n,n,q,D.data),F=new jsfeat.matrix_t(1,o,q,m.data),B=new jsfeat.matrix_t(o,o,q,G.data),r=E.data,x=u.data,p=F.data,g=B.data;for(this.svd_decompose(t,F,u,B,0),w=jsfeat.EPSILON*p[0]*o;o>C;C++,s+=o)for(z=0,v=0;n>z;z++,h++){for(y=0,l=0;o>y;y++,v++)p[y]>w&&(l+=g[s+y]*x[v]/p[y]);r[h]=l}jsfeat.cache.put_buffer(D),jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(G)},eigenVV:function(j,p,r){for(var k=j.cols,m=k*k,g=j.type|jsfeat.C1_t,o=jsfeat.cache.get_buffer(k*k<<3),h=jsfeat.cache.get_buffer(k<<3),l=new jsfeat.matrix_t(k,k,g,o.data),q=new jsfeat.matrix_t(1,k,g,h.data);--m>=0;)l.data[m]=j.data[m];if(c(l.data,k,q.data,p?p.data:null,k,k),r)for(;--k>=0;)r.data[k]=q.data[k];jsfeat.cache.put_buffer(o),jsfeat.cache.put_buffer(h)}}}();b.linalg=a}(jsfeat),function(a){var c=function(){var m=function(p){return p*p},e=function(z,A,x,w,u){for(var t=0,y=0,s=0,q=0,C=0,v=0,r=0,p=0,B=0,E=0,D=0;u>t;++t)y+=z[t].x,s+=z[t].y,v+=A[t].x,r+=A[t].y;for(y/=u,s/=u,v/=u,r/=u,t=0;u>t;++t)E=z[t].x-y,D=z[t].y-s,q+=Math.sqrt(E*E+D*D),E=A[t].x-v,D=A[t].y-r,p+=Math.sqrt(E*E+D*D);q/=u,p/=u,C=Math.SQRT2/q,B=Math.SQRT2/p,x[0]=x[4]=C,x[2]=-y*C,x[5]=-s*C,x[1]=x[3]=x[6]=x[7]=0,x[8]=1,w[0]=w[4]=B,w[2]=-v*B,w[5]=-r*B,w[1]=w[3]=w[6]=w[7]=0,w[8]=1},k=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),i=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),o=new jsfeat.matrix_t(6,6,jsfeat.F32_t|jsfeat.C1_t),n=new jsfeat.matrix_t(6,1,jsfeat.F32_t|jsfeat.C1_t),j=function(){function p(){}return p.prototype.run=function(D,q,r,t){var x,w,G=0,F=0,B=r.type|jsfeat.C1_t,J=r.data,v=k.data,E=i.data,A=0,z=0;e(D,q,v,E,t);for(var u=jsfeat.cache.get_buffer(2*t*6<<3),y=jsfeat.cache.get_buffer(2*t<<3),C=new jsfeat.matrix_t(6,2*t,B,u.data),H=new jsfeat.matrix_t(1,2*t,B,y.data),I=C.data,s=H.data;t>G;++G)x=D[G],w=q[G],A=v[0]*x.x+v[1]*x.y+v[2],z=v[3]*x.x+v[4]*x.y+v[5],F=2*G*6,I[F]=A,I[F+1]=z,I[F+2]=1,I[F+3]=0,I[F+4]=0,I[F+5]=0,F+=6,I[F]=0,I[F+1]=0,I[F+2]=0,I[F+3]=A,I[F+4]=z,I[F+5]=1,s[G<<1]=E[0]*w.x+E[1]*w.y+E[2],s[(G<<1)+1]=E[3]*w.x+E[4]*w.y+E[5];return jsfeat.matmath.multiply_AtA(o,C),jsfeat.matmath.multiply_AtB(n,C,H),jsfeat.linalg.lu_solve(o,n),J[0]=n.data[0],J[1]=n.data[1],J[2]=n.data[2],J[3]=n.data[3],J[4]=n.data[4],J[5]=n.data[5],J[6]=0,J[7]=0,J[8]=1,jsfeat.matmath.invert_3x3(i,i),jsfeat.matmath.multiply_3x3(r,i,r),jsfeat.matmath.multiply_3x3(r,r,k),jsfeat.cache.put_buffer(u),jsfeat.cache.put_buffer(y),1},p.prototype.error=function(v,w,t,r,u){for(var y,x,s=0,q=t.data;u>s;++s)y=v[s],x=w[s],r[s]=m(x.x-q[0]*y.x-q[1]*y.y-q[2])+m(x.y-q[3]*y.x-q[4]*y.y-q[5])},p.prototype.check_subset=function(s,r,q){return!0},p}(),g=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),f=new jsfeat.matrix_t(9,9,jsfeat.F32_t|jsfeat.C1_t),l=function(){function p(){}return p.prototype.run=function(I,r,v,C){for(var L=0,K=0,O=v.data,D=k.data,J=i.data,M=g.data,N=f.data,H=0,G=0,s=0,q=0,u=0,t=0,B=0,A=0,z=0,w=0,F=0,E=0;C>L;++L)B+=r[L].x,A+=r[L].y,F+=I[L].x,E+=I[L].y;for(B/=C,A/=C,F/=C,E/=C,L=0;C>L;++L)u+=Math.abs(r[L].x-B),t+=Math.abs(r[L].y-A),z+=Math.abs(I[L].x-F),w+=Math.abs(I[L].y-E);if(Math.abs(u)<jsfeat.EPSILON||Math.abs(t)<jsfeat.EPSILON||Math.abs(z)<jsfeat.EPSILON||Math.abs(w)<jsfeat.EPSILON)return 0;for(u=C/u,t=C/t,z=C/z,w=C/w,D[0]=z,D[1]=0,D[2]=-F*z,D[3]=0,D[4]=w,D[5]=-E*w,D[6]=0,D[7]=0,D[8]=1,J[0]=1/u,J[1]=0,J[2]=B,J[3]=0,J[4]=1/t,J[5]=A,J[6]=0,J[7]=0,J[8]=1,L=81;--L>=0;)M[L]=0;for(L=0;C>L;++L)H=(r[L].x-B)*u,G=(r[L].y-A)*t,s=(I[L].x-F)*z,q=(I[L].y-E)*w,M[0]+=s*s,M[1]+=s*q,M[2]+=s,M[6]+=s*-H*s,M[7]+=s*-H*q,M[8]+=s*-H,M[10]+=q*q,M[11]+=q,M[15]+=q*-H*s,M[16]+=q*-H*q,M[17]+=q*-H,M[20]+=1,M[24]+=-H*s,M[25]+=-H*q,M[26]+=-H,M[30]+=s*s,M[31]+=s*q,M[32]+=s,M[33]+=s*-G*s,M[34]+=s*-G*q,M[35]+=s*-G,M[40]+=q*q,M[41]+=q,M[42]+=q*-G*s,M[43]+=q*-G*q,M[44]+=q*-G,M[50]+=1,M[51]+=-G*s,M[52]+=-G*q,M[53]+=-G,M[60]+=-H*s*-H*s+-G*s*-G*s,M[61]+=-H*s*-H*q+-G*s*-G*q,M[62]+=-H*s*-H+-G*s*-G,M[70]+=-H*q*-H*q+-G*q*-G*q,M[71]+=-H*q*-H+-G*q*-G,M[80]+=-H*-H+-G*-G;for(L=0;9>L;++L)for(K=0;L>K;++K)M[9*L+K]=M[9*K+L];return jsfeat.linalg.eigenVV(g,f),O[0]=N[72],O[1]=N[73],O[2]=N[74],O[3]=N[75],O[4]=N[76],O[5]=N[77],O[6]=N[78],O[7]=N[79],O[8]=N[80],jsfeat.matmath.multiply_3x3(v,i,v),
jsfeat.matmath.multiply_3x3(v,v,k),H=1/O[8],O[0]*=H,O[1]*=H,O[2]*=H,O[3]*=H,O[4]*=H,O[5]*=H,O[6]*=H,O[7]*=H,O[8]=1,1},p.prototype.error=function(w,x,u,r,v){for(var z,y,t=0,s=0,B=0,A=0,q=u.data;v>t;++t)z=w[t],y=x[t],s=1/(q[6]*z.x+q[7]*z.y+1),B=(q[0]*z.x+q[1]*z.y+q[2])*s-y.x,A=(q[3]*z.x+q[4]*z.y+q[5])*s-y.y,r[t]=B*B+A*A},p.prototype.check_subset=function(M,s,B){if(4==B){var N=0,I=M[0],H=M[1],G=M[2],E=M[3],A=s[0],y=s[1],w=s[2],u=s[3],L=I.x,K=I.y,J=1,V=H.x,U=H.y,T=1,z=G.x,x=G.y,v=1,t=A.x,r=A.y,q=1,F=y.x,D=y.y,C=1,Q=w.x,P=w.y,O=1,S=jsfeat.matmath.determinant_3x3(L,K,J,V,U,T,z,x,v),R=jsfeat.matmath.determinant_3x3(t,r,q,F,D,C,Q,P,O);if(0>S*R&&N++,L=H.x,K=H.y,V=G.x,U=G.y,z=E.x,x=E.y,t=y.x,r=y.y,F=w.x,D=w.y,Q=u.x,P=u.y,S=jsfeat.matmath.determinant_3x3(L,K,J,V,U,T,z,x,v),R=jsfeat.matmath.determinant_3x3(t,r,q,F,D,C,Q,P,O),0>S*R&&N++,L=I.x,K=I.y,V=G.x,U=G.y,z=E.x,x=E.y,t=A.x,r=A.y,F=w.x,D=w.y,Q=u.x,P=u.y,S=jsfeat.matmath.determinant_3x3(L,K,J,V,U,T,z,x,v),R=jsfeat.matmath.determinant_3x3(t,r,q,F,D,C,Q,P,O),0>S*R&&N++,L=I.x,K=I.y,V=H.x,U=H.y,z=E.x,x=E.y,t=A.x,r=A.y,F=y.x,D=y.y,Q=u.x,P=u.y,S=jsfeat.matmath.determinant_3x3(L,K,J,V,U,T,z,x,v),R=jsfeat.matmath.determinant_3x3(t,r,q,F,D,C,Q,P,O),0>S*R&&N++,0!=N&&4!=N)return!1}return!0},p}();return{affine2d:j,homography2d:l}}(),b=function(){function e(h,i,f,g){"undefined"==typeof h&&(h=0),"undefined"==typeof i&&(i=.5),"undefined"==typeof f&&(f=.5),"undefined"==typeof g&&(g=.99),this.size=h,this.thresh=i,this.eps=f,this.prob=g}return e.prototype.update_iters=function(g,i){var h=Math.log(1-this.prob),f=Math.log(1-Math.pow(1-g,this.size));return 0|(f>=0||-h>=i*-f?i:Math.round(h/f))},e}(),d=function(){var e=function(l,q,r,p,t,m,g){for(var v=1e3,s=[],n=0,k=0,u=0,h=0,o=!1;v>u;++u){for(n=0;p>n&&v>u;){for(o=!1,h=0;!o;)for(o=!0,h=s[n]=0|Math.floor(Math.random()*t),k=0;n>k;++k)if(h==s[k]){o=!1;break}m[n]=q[h],g[n]=r[h],l.check_subset(m,g,n+1)?++n:u++}break}return n==p&&v>u},f=function(k,m,p,q,o,g,h,s){var j=0,l=0,n=0,r=g*g;for(k.error(p,q,m,h,o);o>l;++l)n=h[l]<=r,s[l]=n,j+=n;return j};return{ransac:function(E,m,x,i,l,j,y,g){if("undefined"==typeof g&&(g=1e3),l<E.size)return!1;var v=E.size,A=g,z=0,q=!1,D=[],C=[],r=!1,G=j.cols,w=j.rows,u=j.type|jsfeat.C1_t,B=jsfeat.cache.get_buffer(G*w<<3),h=jsfeat.cache.get_buffer(l),t=jsfeat.cache.get_buffer(l<<2),o=new jsfeat.matrix_t(G,w,u,B.data),s=new jsfeat.matrix_t(l,1,jsfeat.U8C1_t,h.data),F=-1,p=0,n=0,k=t.f32;if(l==v){if(m.run(x,i,o,l)<=0)return jsfeat.cache.put_buffer(B),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(t),!1;if(o.copy_to(j),y)for(;--l>=0;)y.data[l]=1;return jsfeat.cache.put_buffer(B),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(t),!0}for(;A>z;++z){if(r=e(m,x,i,v,l,D,C),!r){if(0==z)return jsfeat.cache.put_buffer(B),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(t),!1;break}n=m.run(D,C,o,v),0>=n||(p=f(m,o,x,i,l,E.thresh,k,s.data),p>Math.max(F,v-1)&&(o.copy_to(j),F=p,y&&s.copy_to(y),A=E.update_iters((l-p)/l,A),q=!0))}return jsfeat.cache.put_buffer(B),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(t),q},lmeds:function(H,n,z,i,l,j,B,g){if("undefined"==typeof g&&(g=1e3),l<H.size)return!1;var w=H.size,D=g,C=0,r=!1,G=[],F=[],s=!1,I=j.cols,y=j.rows,v=j.type|jsfeat.C1_t,E=jsfeat.cache.get_buffer(I*y<<3),h=jsfeat.cache.get_buffer(l),u=jsfeat.cache.get_buffer(l<<2),p=new jsfeat.matrix_t(I,y,v,E.data),t=new jsfeat.matrix_t(l,1,jsfeat.U8_t|jsfeat.C1_t,h.data),q=0,o=0,k=u.f32,A=1e9,x=0,m=0;if(H.eps=.45,D=H.update_iters(H.eps,D),l==w){if(n.run(z,i,p,l)<=0)return jsfeat.cache.put_buffer(E),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(u),!1;if(p.copy_to(j),B)for(;--l>=0;)B.data[l]=1;return jsfeat.cache.put_buffer(E),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(u),!0}for(;D>C;++C){if(s=e(n,z,i,w,l,G,F),!s){if(0==C)return jsfeat.cache.put_buffer(E),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(u),!1;break}o=n.run(G,F,p,w),0>=o||(n.error(z,i,p,k,l),m=jsfeat.math.median(k,0,l-1),A>m&&(A=m,p.copy_to(j),r=!0))}return r&&(x=2.5*1.4826*(1+5/(l-w))*Math.sqrt(A),x=Math.max(x,.001),q=f(n,j,z,i,l,x,k,t.data),B&&t.copy_to(B),r=q>=w),jsfeat.cache.put_buffer(E),jsfeat.cache.put_buffer(h),jsfeat.cache.put_buffer(u),r}}}();a.ransac_params_t=b,a.motion_model=c,a.motion_estimator=d}(jsfeat),function(b){var a=function(){var c=function(q,S,O,p){for(var r=0,y=q.channel,v=q.cols,J=q.rows,P=q.data,m=S.data,I=v/O,H=J/p,n=I*H*65536|0,x=0,u=0,C=0,A=0,t=0,s=0,G=0,F=0,D=0,B=0,Q=0,N=0,K=0,o=0,M=0,E=0,l=jsfeat.cache.get_buffer(O*y<<2),g=jsfeat.cache.get_buffer(O*y<<2),R=jsfeat.cache.get_buffer(2*v*3<<2),L=l.i32,j=g.i32,z=R.i32;O>x;x++){for(D=x*I,B=D+I,t=D+1-1e-6|0,s=0|B,t=Math.min(t,v-1),s=Math.min(s,v-1),t>D&&(z[F++]=x*y|0,z[F++]=(t-1)*y|0,z[F++]=256*(t-D)|0,r++),C=t;s>C;C++)r++,z[F++]=x*y|0,z[F++]=C*y|0,z[F++]=256;B-s>.001&&(r++,z[F++]=x*y|0,z[F++]=s*y|0,z[F++]=256*(B-s)|0)}for(x=0;O*y>x;x++)L[x]=j[x]=0;for(u=0,A=0;J>A;A++){for(Q=v*A,F=0;r>F;F++)for(K=z[3*F],t=z[3*F+1],o=z[3*F+2],G=0;y>G;G++)L[K+G]+=P[Q+t+G]*o;if(A+1>=(u+1)*H||A==J-1){if(M=256*Math.max(A+1-(u+1)*H,0)|0,E=256-M,N=O*u,0>=M)for(x=0;O*y>x;x++)m[N+x]=Math.min(Math.max((j[x]+256*L[x])/n,0),255),j[x]=L[x]=0;else for(x=0;O*y>x;x++)m[N+x]=Math.min(Math.max((j[x]+L[x]*E)/n,0),255),j[x]=L[x]*M,L[x]=0;u++}else for(x=0;O*y>x;x++)j[x]+=256*L[x],L[x]=0}jsfeat.cache.put_buffer(g),jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(R)},f=function(p,S,N,o){for(var q=0,x=p.channel,u=p.cols,I=p.rows,O=p.data,m=S.data,H=u/N,G=I/o,Q=1/(H*G),v=0,t=0,B=0,z=0,s=0,r=0,F=0,E=0,C=0,A=0,P=0,M=0,J=0,n=0,L=0,D=0,l=jsfeat.cache.get_buffer(N*x<<2),g=jsfeat.cache.get_buffer(N*x<<2),R=jsfeat.cache.get_buffer(2*u*3<<2),K=l.f32,j=g.f32,y=R.f32;N>v;v++){for(C=v*H,A=C+H,s=C+1-1e-6|0,r=0|A,s=Math.min(s,u-1),r=Math.min(r,u-1),s>C&&(q++,y[E++]=(s-1)*x|0,y[E++]=v*x|0,y[E++]=(s-C)*Q),B=s;r>B;B++)q++,y[E++]=B*x|0,y[E++]=v*x|0,y[E++]=Q;A-r>.001&&(q++,y[E++]=r*x|0,y[E++]=v*x|0,y[E++]=(A-r)*Q)}for(v=0;N*x>v;v++)K[v]=j[v]=0;for(t=0,z=0;I>z;z++){for(P=u*z,E=0;q>E;E++)for(s=0|y[3*E],J=0|y[3*E+1],n=y[3*E+2],F=0;x>F;F++)K[J+F]+=O[P+s+F]*n;if(z+1>=(t+1)*G||z==I-1){if(L=Math.max(z+1-(t+1)*G,0),D=1-L,M=N*t,Math.abs(L)<.001)for(v=0;N*x>v;v++)m[M+v]=j[v]+K[v],j[v]=K[v]=0;else for(v=0;N*x>v;v++)m[M+v]=j[v]+K[v]*D,j[v]=K[v]*L,K[v]=0;t++}else for(v=0;N*x>v;v++)j[v]+=K[v],K[v]=0}jsfeat.cache.put_buffer(g),jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(R)},e=function(D,F,m,s,B,t,g,n){for(var z=0,y=0,x=0,A=0,u=0,l=0,G=0,E=0,C=0,v=t[0],r=0,q=s<<1,p=3*s,o=s<<2;B>z;++z){for(l=F[A],y=0;n>y;++y)D[y]=l;for(y=0;s-2>=y;y+=2)D[y+n]=F[A+y],D[y+n+1]=F[A+y+1];for(;s>y;++y)D[y+n]=F[A+y];for(l=F[A+s-1],y=s;n+s>y;++y)D[y+n]=l;for(y=0;s-4>=y;y+=4){for(l=D[y]*v,G=D[y+1]*v,E=D[y+2]*v,C=D[y+3]*v,x=1;g>x;++x)r=t[x],l+=D[x+y]*r,G+=D[x+y+1]*r,E+=D[x+y+2]*r,C+=D[x+y+3]*r;m[u+y]=Math.min(l>>8,255),m[u+y+1]=Math.min(G>>8,255),m[u+y+2]=Math.min(E>>8,255),m[u+y+3]=Math.min(C>>8,255)}for(;s>y;++y){for(l=D[y]*v,x=1;g>x;++x)l+=D[x+y]*t[x];m[u+y]=Math.min(l>>8,255)}A+=s,u+=s}for(z=0;s>z;++z){for(l=m[z],y=0;n>y;++y)D[y]=l;for(x=z,y=0;B-2>=y;y+=2,x+=q)D[y+n]=m[x],D[y+n+1]=m[x+s];for(;B>y;++y,x+=s)D[y+n]=m[x];for(l=m[(B-1)*s+z],y=B;n+B>y;++y)D[y+n]=l;for(u=z,y=0;B-4>=y;y+=4,u+=o){for(l=D[y]*v,G=D[y+1]*v,E=D[y+2]*v,C=D[y+3]*v,x=1;g>x;++x)r=t[x],l+=D[x+y]*r,G+=D[x+y+1]*r,E+=D[x+y+2]*r,C+=D[x+y+3]*r;m[u]=Math.min(l>>8,255),m[u+s]=Math.min(G>>8,255),m[u+q]=Math.min(E>>8,255),m[u+p]=Math.min(C>>8,255)}for(;B>y;++y,u+=s){for(l=D[y]*v,x=1;g>x;++x)l+=D[x+y]*t[x];m[u]=Math.min(l>>8,255)}}},d=function(D,F,m,s,B,t,g,n){for(var z=0,y=0,x=0,A=0,u=0,l=0,G=0,E=0,C=0,v=t[0],r=0,q=s<<1,p=3*s,o=s<<2;B>z;++z){for(l=F[A],y=0;n>y;++y)D[y]=l;for(y=0;s-2>=y;y+=2)D[y+n]=F[A+y],D[y+n+1]=F[A+y+1];for(;s>y;++y)D[y+n]=F[A+y];for(l=F[A+s-1],y=s;n+s>y;++y)D[y+n]=l;for(y=0;s-4>=y;y+=4){for(l=D[y]*v,G=D[y+1]*v,E=D[y+2]*v,C=D[y+3]*v,x=1;g>x;++x)r=t[x],l+=D[x+y]*r,G+=D[x+y+1]*r,E+=D[x+y+2]*r,C+=D[x+y+3]*r;m[u+y]=l,m[u+y+1]=G,m[u+y+2]=E,m[u+y+3]=C}for(;s>y;++y){for(l=D[y]*v,x=1;g>x;++x)l+=D[x+y]*t[x];m[u+y]=l}A+=s,u+=s}for(z=0;s>z;++z){for(l=m[z],y=0;n>y;++y)D[y]=l;for(x=z,y=0;B-2>=y;y+=2,x+=q)D[y+n]=m[x],D[y+n+1]=m[x+s];for(;B>y;++y,x+=s)D[y+n]=m[x];for(l=m[(B-1)*s+z],y=B;n+B>y;++y)D[y+n]=l;for(u=z,y=0;B-4>=y;y+=4,u+=o){for(l=D[y]*v,G=D[y+1]*v,E=D[y+2]*v,C=D[y+3]*v,x=1;g>x;++x)r=t[x],l+=D[x+y]*r,G+=D[x+y+1]*r,E+=D[x+y+2]*r,C+=D[x+y+3]*r;m[u]=l,m[u+s]=G,m[u+q]=E,m[u+p]=C}for(;B>y;++y,u+=s){for(l=D[y]*v,x=1;g>x;++x)l+=D[x+y]*t[x];m[u]=l}}};return{grayscale:function(n,r,A,D,g){"undefined"==typeof g&&(g=jsfeat.COLOR_RGBA2GRAY);var q=0,p=0,z=0,v=0,m=0,u=0,s=4899,B=9617,C=1868,o=4;g!=jsfeat.COLOR_BGRA2GRAY&&g!=jsfeat.COLOR_BGR2GRAY||(s=1868,C=4899),g!=jsfeat.COLOR_RGB2GRAY&&g!=jsfeat.COLOR_BGR2GRAY||(o=3);var l=o<<1,k=3*o|0;D.resize(r,A,1);var t=D.data;for(p=0;A>p;++p,v+=r,z+=r*o){for(q=0,m=z,u=v;r-4>=q;q+=4,m+=o<<2,u+=4)t[u]=n[m]*s+n[m+1]*B+n[m+2]*C+8192>>14,t[u+1]=n[m+o]*s+n[m+o+1]*B+n[m+o+2]*C+8192>>14,t[u+2]=n[m+l]*s+n[m+l+1]*B+n[m+l+2]*C+8192>>14,t[u+3]=n[m+k]*s+n[m+k+1]*B+n[m+k+2]*C+8192>>14;for(;r>q;++q,++u,m+=o)t[u]=n[m]*s+n[m+1]*B+n[m+2]*C+8192>>14}},resample:function(l,m,i,k){var j=l.rows,g=l.cols;j>k&&g>i&&(m.resize(i,k,l.channel),l.type&jsfeat.U8_t&&m.type&jsfeat.U8_t&&256>j*g/(k*i)?c(l,m,i,k):f(l,m,i,k))},box_blur_gray:function(r,J,n,l){"undefined"==typeof l&&(l=0);var z=r.cols,E=r.rows,s=E<<1,v=z<<1,D=0,u=0,t=0,m=0,B=(n<<1)+1|0,p=n+1|0,H=p+1|0,I=l&jsfeat.BOX_BLUR_NOSCALE?1:1/(B*B),C=jsfeat.cache.get_buffer(z*E<<2),j=0,G=0,o=0,q=0,k=0,F=C.i32,g=r.data,A=0;for(J.resize(z,E,r.channel),t=0;E>t;++t){for(G=t,j=p*g[o],D=o+1|0,m=o+n|0;m>=D;++D)j+=g[D];for(q=o+p|0,k=o,A=g[k],u=0;n>u;++u,G+=E)F[G]=j,j+=g[q]-A,q++;for(;z-H>u;u+=2,G+=s)F[G]=j,j+=g[q]-g[k],F[G+E]=j,j+=g[q+1]-g[k+1],q+=2,k+=2;for(;z-p>u;++u,G+=E)F[G]=j,j+=g[q]-g[k],q++,k++;for(A=g[q-1];z>u;++u,G+=E)F[G]=j,j+=A-g[k],k++;o+=z}if(o=0,g=J.data,1==I)for(t=0;z>t;++t){for(G=t,j=p*F[o],D=o+1|0,m=o+n|0;m>=D;++D)j+=F[D];for(q=o+p,k=o,A=F[k],u=0;n>u;++u,G+=z)g[G]=j,j+=F[q]-A,q++;for(;E-H>u;u+=2,G+=v)g[G]=j,j+=F[q]-F[k],g[G+z]=j,j+=F[q+1]-F[k+1],q+=2,k+=2;for(;E-p>u;++u,G+=z)g[G]=j,j+=F[q]-F[k],q++,k++;for(A=F[q-1];E>u;++u,G+=z)g[G]=j,j+=A-F[k],k++;o+=E}else for(t=0;z>t;++t){for(G=t,j=p*F[o],D=o+1|0,m=o+n|0;m>=D;++D)j+=F[D];for(q=o+p,k=o,A=F[k],u=0;n>u;++u,G+=z)g[G]=j*I,j+=F[q]-A,q++;for(;E-H>u;u+=2,G+=v)g[G]=j*I,j+=F[q]-F[k],g[G+z]=j*I,j+=F[q+1]-F[k+1],q+=2,k+=2;for(;E-p>u;++u,G+=z)g[G]=j*I,j+=F[q]-F[k],q++,k++;for(A=F[q-1];E>u;++u,G+=z)g[G]=j*I,j+=A-F[k],k++;o+=E}jsfeat.cache.put_buffer(C)},gaussian_blur:function(g,s,r,v){"undefined"==typeof v&&(v=0),"undefined"==typeof r&&(r=0),r=0==r?2*Math.max(1,4*v+1-1e-8)+1|0:r;var x=r>>1,t=g.cols,p=g.rows,u=g.type,n=u&jsfeat.U8_t;s.resize(t,p,g.channel);var k,i,m=g.data,j=s.data,q=r+Math.max(p,t)|0,l=jsfeat.cache.get_buffer(q<<2),o=jsfeat.cache.get_buffer(r<<2);n?(k=l.i32,i=o.i32):u&jsfeat.S32_t?(k=l.i32,i=o.f32):(k=l.f32,i=o.f32),jsfeat.math.get_gaussian_kernel(r,v,i,u),n?e(k,m,j,t,p,i,r,x):d(k,m,j,t,p,i,r,x),jsfeat.cache.put_buffer(l),jsfeat.cache.put_buffer(o)},pyrdown:function(k,A,s,r){"undefined"==typeof s&&(s=0),"undefined"==typeof r&&(r=0);var q=k.cols,t=k.rows,p=q>>1,l=t>>1,B=p-(s<<1),u=l-(r<<1),o=0,n=0,g=s+r*q,m=0,v=0,i=0;A.resize(p,l,k.channel);var z=k.data,j=A.data;for(n=0;u>n;++n){for(m=g,i=v,o=0;B-2>=o;o+=2,i+=2,m+=4)j[i]=z[m]+z[m+1]+z[m+q]+z[m+q+1]+2>>2,j[i+1]=z[m+2]+z[m+3]+z[m+q+2]+z[m+q+3]+2>>2;for(;B>o;++o,++i,m+=2)j[i]=z[m]+z[m+1]+z[m+q]+z[m+q+1]+2>>2;g+=q<<1,v+=p}},scharr_derivatives:function(j,G){var E,D,C,B,A,z,n,l,p=j.cols,s=j.rows,H=p<<1,o=0,m=0,u=0,v=0,t=0,r=0,i=0;G.resize(p,s,2);var F=j.data,g=G.data,k=jsfeat.cache.get_buffer(p+2<<2),q=jsfeat.cache.get_buffer(p+2<<2);for(j.type&jsfeat.U8_t||j.type&jsfeat.S32_t?(n=k.i32,l=q.i32):(n=k.f32,l=q.f32);s>m;++m,t+=p){for(v=(m>0?m-1:1)*p|0,r=(s-1>m?m+1:s-2)*p|0,i=m*H|0,o=0,u=1;p-2>=o;o+=2,u+=2)E=F[v+o],D=F[r+o],n[u]=3*(E+D)+10*F[t+o],l[u]=D-E,E=F[v+o+1],D=F[r+o+1],n[u+1]=3*(E+D)+10*F[t+o+1],l[u+1]=D-E;for(;p>o;++o,++u)E=F[v+o],D=F[r+o],n[u]=3*(E+D)+10*F[t+o],l[u]=D-E;for(o=p+1|0,n[0]=n[1],n[o]=n[p],l[0]=l[1],l[o]=l[p],o=0;p-4>=o;o+=4)E=l[o+2],D=l[o+1],C=l[o+3],B=l[o+4],A=n[o+2],z=n[o+3],g[i++]=A-n[o],g[i++]=3*(E+l[o])+10*D,g[i++]=z-n[o+1],g[i++]=3*(C+D)+10*E,g[i++]=n[o+4]-A,g[i++]=3*(B+E)+10*C,g[i++]=n[o+5]-z,g[i++]=3*(l[o+5]+C)+10*B;for(;p>o;++o)g[i++]=n[o+2]-n[o],g[i++]=3*(l[o+2]+l[o])+10*l[o+1]}jsfeat.cache.put_buffer(k),jsfeat.cache.put_buffer(q)},sobel_derivatives:function(j,G){var E,D,C,B,A,z,n,l,p=j.cols,s=j.rows,H=p<<1,o=0,m=0,u=0,v=0,t=0,r=0,i=0;G.resize(p,s,2);var F=j.data,g=G.data,k=jsfeat.cache.get_buffer(p+2<<2),q=jsfeat.cache.get_buffer(p+2<<2);for(j.type&jsfeat.U8_t||j.type&jsfeat.S32_t?(n=k.i32,l=q.i32):(n=k.f32,l=q.f32);s>m;++m,t+=p){for(v=(m>0?m-1:1)*p|0,r=(s-1>m?m+1:s-2)*p|0,i=m*H|0,o=0,u=1;p-2>=o;o+=2,u+=2)E=F[v+o],D=F[r+o],n[u]=E+D+2*F[t+o],l[u]=D-E,E=F[v+o+1],D=F[r+o+1],n[u+1]=E+D+2*F[t+o+1],l[u+1]=D-E;for(;p>o;++o,++u)E=F[v+o],D=F[r+o],n[u]=E+D+2*F[t+o],l[u]=D-E;for(o=p+1|0,n[0]=n[1],n[o]=n[p],l[0]=l[1],l[o]=l[p],o=0;p-4>=o;o+=4)E=l[o+2],D=l[o+1],C=l[o+3],B=l[o+4],A=n[o+2],z=n[o+3],g[i++]=A-n[o],g[i++]=E+l[o]+2*D,g[i++]=z-n[o+1],g[i++]=C+D+2*E,g[i++]=n[o+4]-A,g[i++]=B+E+2*C,g[i++]=n[o+5]-z,g[i++]=l[o+5]+C+2*B;for(;p>o;++o)g[i++]=n[o+2]-n[o],g[i++]=l[o+2]+l[o]+2*l[o+1]}jsfeat.cache.put_buffer(k),jsfeat.cache.put_buffer(q)},compute_integral_image:function(g,l,y,u){var t=0|g.cols,w=0|g.rows,o=g.data,r=t+1|0,B=0,z=0,h=0,x=0,q=0,n=0,A=0,m=0;if(l&&y){for(;r>q;++q)l[q]=0,y[q]=0;for(h=r+1|0,x=1,q=0,m=0;w>q;++q,++h,++x){for(B=z=0,n=0;t-2>=n;n+=2,m+=2,h+=2,x+=2)A=o[m],B+=A,z+=A*A,l[h]=l[x]+B,y[h]=y[x]+z,A=o[m+1],B+=A,z+=A*A,l[h+1]=l[x+1]+B,y[h+1]=y[x+1]+z;for(;t>n;++n,++m,++h,++x)A=o[m],B+=A,z+=A*A,l[h]=l[x]+B,y[h]=y[x]+z}}else if(l){for(;r>q;++q)l[q]=0;for(h=r+1|0,x=1,q=0,m=0;w>q;++q,++h,++x){for(B=0,n=0;t-2>=n;n+=2,m+=2,h+=2,x+=2)B+=o[m],l[h]=l[x]+B,B+=o[m+1],l[h+1]=l[x+1]+B;for(;t>n;++n,++m,++h,++x)B+=o[m],l[h]=l[x]+B}}else if(y){for(;r>q;++q)y[q]=0;for(h=r+1|0,x=1,q=0,m=0;w>q;++q,++h,++x){for(z=0,n=0;t-2>=n;n+=2,m+=2,h+=2,x+=2)A=o[m],z+=A*A,y[h]=y[x]+z,A=o[m+1],z+=A*A,y[h+1]=y[x+1]+z;for(;t>n;++n,++m,++h,++x)A=o[m],z+=A*A,y[h]=y[x]+z}}if(u){for(q=0;r>q;++q)u[q]=0;for(h=r+1|0,x=0,q=0,m=0;w>q;++q,++h,++x){for(n=0;t-2>=n;n+=2,m+=2,h+=2,x+=2)u[h]=o[m]+u[x],u[h+1]=o[m+1]+u[x+1];for(;t>n;++n,++m,++h,++x)u[h]=o[m]+u[x]}for(h=r+t|0,x=t,q=0;w>q;++q,h+=r,x+=r)u[h]+=u[x];for(n=t-1;n>0;--n)for(h=n+w*r,x=h-r,q=w;q>0;--q,h-=r,x-=r)u[h]+=u[x]+u[x+1]}},equalize_histogram:function(j,r){var s=j.cols,q=j.rows,o=j.data;r.resize(s,q,j.channel);var k,g,l=r.data,t=s*q,p=0,n=0,m=jsfeat.cache.get_buffer(1024);for(k=m.i32;256>p;++p)k[p]=0;for(p=0;t>p;++p)++k[o[p]];for(n=k[0],p=1;256>p;++p)n=k[p]+=n;for(g=255/t,p=0;t>p;++p)l[p]=k[o[p]]*g+.5|0;jsfeat.cache.put_buffer(m)},canny:function(u,V,E,k){var C=u.cols,L=u.rows;u.data;V.resize(C,L,u.channel);var o=V.data,K=0,H=0,q=0,A=C<<1,R=0,J=0,N=0,z=0,v=0,D=0,g=0,U=0,p=jsfeat.cache.get_buffer(L*A<<2),m=jsfeat.cache.get_buffer(3*(C+2)<<2),n=jsfeat.cache.get_buffer((L+2)*(C+2)<<2),t=jsfeat.cache.get_buffer(L*C<<2),Q=m.i32,T=n.i32,r=t.i32,G=p.i32,l=new jsfeat.matrix_t(C,L,jsfeat.S32C2_t,p.data),P=1,O=C+2+1|0,M=2*(C+2)+1|0,B=C+2|0,I=B+1|0,F=0;for(this.sobel_derivatives(u,l),E>k&&(K=E,E=k,k=K),K=3*(C+2)|0;--K>=0;)Q[K]=0;for(K=(L+2)*(C+2)|0;--K>=0;)T[K]=0;for(;C>H;++H,q+=2)z=G[q],v=G[q+1],Q[O+H]=(z^z>>31)-(z>>31)+((v^v>>31)-(v>>31));for(K=1;L>=K;++K,q+=A){if(K==L)for(H=M+C;--H>=M;)Q[H]=0;else for(H=0;C>H;H++)z=G[q+(H<<1)],v=G[q+(H<<1)+1],Q[M+H]=(z^z>>31)-(z>>31)+((v^v>>31)-(v>>31));for(R=q-A|0,T[I-1]=0,J=0,H=0;C>H;++H,R+=2){if(N=Q[O+H],N>E)if(z=G[R],v=G[R+1],D=z^v,z=(z^z>>31)-(z>>31)|0,v=(v^v>>31)-(v>>31)|0,g=13573*z,U=g+(z+z<<15),v<<=15,g>v){if(N>Q[O+H-1]&&N>=Q[O+H+1]){N>k&&!J&&2!=T[I+H-B]?(T[I+H]=2,J=1,r[F++]=I+H):T[I+H]=1;continue}}else if(v>U){if(N>Q[P+H]&&N>=Q[M+H]){N>k&&!J&&2!=T[I+H-B]?(T[I+H]=2,J=1,r[F++]=I+H):T[I+H]=1;continue}}else if(D=0>D?-1:1,N>Q[P+H-D]&&N>Q[M+H+D]){N>k&&!J&&2!=T[I+H-B]?(T[I+H]=2,J=1,r[F++]=I+H):T[I+H]=1;continue}T[I+H]=0,J=0}T[I+C]=0,I+=B,H=P,P=O,O=M,M=H}for(H=I-B-1,K=0;B>K;++K,++H)T[H]=0;for(;F>0;)I=r[--F],I-=B+1,1==T[I]&&(T[I]=2,r[F++]=I),I+=1,1==T[I]&&(T[I]=2,r[F++]=I),I+=1,1==T[I]&&(T[I]=2,r[F++]=I),I+=B,1==T[I]&&(T[I]=2,r[F++]=I),I-=2,1==T[I]&&(T[I]=2,r[F++]=I),I+=B,1==T[I]&&(T[I]=2,r[F++]=I),I+=1,1==T[I]&&(T[I]=2,r[F++]=I),I+=1,1==T[I]&&(T[I]=2,r[F++]=I);for(I=B+1,P=0,K=0;L>K;++K,I+=B)for(H=0;C>H;++H)o[P++]=255*(2==T[I+H]);jsfeat.cache.put_buffer(p),jsfeat.cache.put_buffer(m),jsfeat.cache.put_buffer(n),jsfeat.cache.put_buffer(t)},warp_perspective:function(t,D,A,r){"undefined"==typeof r&&(r=0);for(var l=0|t.cols,v=0|t.rows,L=0|D.cols,j=0|D.rows,H=t.data,q=D.data,F=0,E=0,G=0,u=0,k=0,C=0,p=0,h=0,O=0,P=0,s=0,R=0,Q=0,N=0,M=0,i=A.data,o=i[0],n=i[1],m=i[2],K=i[3],J=i[4],I=i[5],B=i[6],z=i[7],w=i[8],g=0;j>E;++E)for(h=n*E+m,O=J*E+I,P=z*E+w,F=0;L>F;++F,++g,h+=o,O+=K,P+=B)s=1/P,C=h*s,p=O*s,u=0|C,k=0|p,C>0&&p>0&&l-1>u&&v-1>k?(R=Math.max(C-u,0),Q=Math.max(p-k,0),G=l*k+u|0,N=H[G]+R*(H[G+1]-H[G]),M=H[G+l]+R*(H[G+l+1]-H[G+l]),q[g]=N+Q*(M-N)):q[g]=r},warp_affine:function(k,K,p,J){"undefined"==typeof J&&(J=0);for(var u=k.cols,z=k.rows,j=K.cols,v=K.rows,E=k.data,i=K.data,o=0,n=0,I=0,q=0,A=0,m=0,w=0,G=0,D=0,h=0,g=0,l=p.data,t=l[0],s=l[1],r=l[2],H=l[3],F=l[4],C=l[5],B=0;v>n;++n)for(m=s*n+r,w=F*n+C,o=0;j>o;++o,++B,m+=t,w+=H)q=0|m,A=0|w,q>=0&&A>=0&&u-1>q&&z-1>A?(G=m-q,D=w-A,I=u*A+q,h=E[I]+G*(E[I+1]-E[I]),g=E[I+u]+G*(E[I+u+1]-E[I+u]),i[B]=h+D*(g-h)):i[B]=J},skindetector:function(o,p){for(var n,m,h,k,l=o.width*o.height;l--;)k=4*l,n=o.data[k],m=o.data[k+1],h=o.data[k+2],n>95&&m>40&&h>20&&n>m&&n>h&&n-Math.min(m,h)>15&&Math.abs(n-m)>15?p[l]=255:p[l]=0}}}();b.imgproc=a}(jsfeat),function(a){var b=function(){var h=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),f=new Uint8Array(512),e=new Int32Array(25),i=new Int32Array(25),d=function(l,n,o){for(var j=0,m=h;o>j;++j)l[j]=m[j<<1]+m[(j<<1)+1]*n;for(;25>j;++j)l[j]=l[j-o]},g=function(j,n,l,r,p){for(var q=25,o=0,w=j[n],m=p,t=0,u=0,s=0;q>o;++o)r[o]=w-j[n+l[o]];for(o=0;16>o;o+=2)t=Math.min(r[o+1],r[o+2]),t=Math.min(t,r[o+3]),m>=t||(t=Math.min(t,r[o+4]),t=Math.min(t,r[o+5]),t=Math.min(t,r[o+6]),t=Math.min(t,r[o+7]),t=Math.min(t,r[o+8]),m=Math.max(m,Math.min(t,r[o])),m=Math.max(m,Math.min(t,r[o+9])));for(u=-m,o=0;16>o;o+=2)s=Math.max(r[o+1],r[o+2]),s=Math.max(s,r[o+3]),s=Math.max(s,r[o+4]),s=Math.max(s,r[o+5]),s>=u||(s=Math.max(s,r[o+6]),s=Math.max(s,r[o+7]),s=Math.max(s,r[o+8]),u=Math.min(u,Math.max(s,r[o])),u=Math.min(u,Math.max(s,r[o+9])));return-u-1},c=20;return{set_threshold:function(j){c=Math.min(Math.max(j,0),255);for(var k=-255;255>=k;++k)f[k+255]=-c>k?1:k>c?2:0;return c},detect:function(L,H,D){"undefined"==typeof D&&(D=3);var C,A=8,t=25,u=L.data,X=L.cols,ar=L.rows,ap=0,an=0,al=0,E=0,W=0,aq=0,B=jsfeat.cache.get_buffer(3*X),O=jsfeat.cache.get_buffer(3*(X+1)<<2),I=B.u8,F=O.i32,M=e,J=i,y=Math.max(3,D),Z=Math.min(ar-2,ar-D),z=Math.max(3,D),aa=Math.min(X-3,X-D),ah=0,P=0,Q=g,G=f,p=c,Y=0,ao=0,au=0,aw=0,U=0,V=0,av=0,R=0,at=0,T=0,S=0,o=0;d(M,X,16);var am=M[0],ak=M[1],aj=M[2],ai=M[3],ag=M[4],af=M[5],ae=M[6],ad=M[7],ac=M[8],ab=M[9],s=M[10],r=M[11],q=M[12],n=M[13],m=M[14],l=M[15];for(ap=0;3*X>ap;++ap)I[ap]=0;for(ap=y;Z>ap;++ap){for(av=ap*X+z|0,aq=(ap-3)%3,V=aq*X|0,U=aq*(X+1)|0,an=0;X>an;++an)I[V+an]=0;if(aw=0,Z-1>ap)for(an=z;aa>an;++an,++av)if(Y=u[av],ao=-Y+255,au=G[ao+u[av+am]]|G[ao+u[av+ac]],0!=au&&(au&=G[ao+u[av+aj]]|G[ao+u[av+s]],au&=G[ao+u[av+ag]]|G[ao+u[av+q]],au&=G[ao+u[av+ae]]|G[ao+u[av+m]],0!=au)){if(au&=G[ao+u[av+ak]]|G[ao+u[av+ab]],au&=G[ao+u[av+ai]]|G[ao+u[av+r]],au&=G[ao+u[av+af]]|G[ao+u[av+n]],au&=G[ao+u[av+ad]]|G[ao+u[av+l]],1&au)for(E=Y-p,ah=0,al=0;t>al;++al)if(W=u[av+M[al]],E>W){if(++ah,ah>A){++aw,F[U+aw]=an,I[V+an]=Q(u,av,M,J,p);break}}else ah=0;if(2&au)for(E=Y+p,ah=0,al=0;t>al;++al)if(W=u[av+M[al]],W>E){if(++ah,ah>A){++aw,F[U+aw]=an,I[V+an]=Q(u,av,M,J,p);break}}else ah=0}if(F[U+X]=aw,ap!=y)for(aq=(ap-4+3)%3,R=aq*X|0,U=aq*(X+1)|0,aq=(ap-5+3)%3,at=aq*X|0,aw=F[U+X],al=0;aw>al;++al)an=F[U+al],T=an+1|0,S=an-1|0,o=I[R+an],o>I[R+T]&&o>I[R+S]&&o>I[at+S]&&o>I[at+an]&&o>I[at+T]&&o>I[V+S]&&o>I[V+an]&&o>I[V+T]&&(C=H[P],C.x=an,C.y=ap-1,C.score=o,P++)}return jsfeat.cache.put_buffer(B),jsfeat.cache.put_buffer(O),P}}}();a.fast_corners=b,b.set_threshold(20)}(jsfeat),function(b){var a=function(){var d=function(e,l,q,i,r,g,p,n,k,j){var m=0,o=0,f=n*q+p|0,s=f;for(m=n;j>m;++m,f+=q,s=f)for(o=p;k>o;++o,++s)l[s]=-4*e[s]+e[s+r]+e[s-r]+e[s+g]+e[s-g]},c=function(e,f,k,m,g,l,h){var o=-2*e[f]+e[f+m]+e[f-m],i=-2*e[f]+e[f+g]+e[f-g],n=e[f+l]+e[f-l]-e[f+h]-e[f-h],j=0|Math.sqrt((o-i)*(o-i)+4*n*n);return Math.min(Math.abs(k-j),Math.abs(-(k+j)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(l,A,z){"undefined"==typeof z&&(z=5);var v,o=0,n=0,p=l.cols,B=l.rows,q=l.data,H=5,f=5*p|0,G=3+3*p|0,g=3-3*p|0,e=jsfeat.cache.get_buffer(p*B<<2),j=e.i32,i=0,k=0,m=0,r=0,u=0,F=this.laplacian_threshold,D=this.min_eigen_value_threshold,t=0|Math.max(5,z),s=0|Math.max(3,z),E=0|Math.min(p-5,p-z),C=0|Math.min(B-3,B-z);for(o=p*B;--o>=0;)j[o]=0;for(d(q,j,p,B,H,f,t,s,E,C),k=s*p+t|0,n=s;C>n;++n,k+=p)for(o=t,m=k;E>o;++o,++m)i=j[m],(-F>i&&i<j[m-1]&&i<j[m+1]&&i<j[m-p]&&i<j[m+p]&&i<j[m-p-1]&&i<j[m+p-1]&&i<j[m-p+1]&&i<j[m+p+1]||i>F&&i>j[m-1]&&i>j[m+1]&&i>j[m-p]&&i>j[m+p]&&i>j[m-p-1]&&i>j[m+p-1]&&i>j[m-p+1]&&i>j[m+p+1])&&(r=c(q,m,i,H,f,G,g),r>D&&(v=A[u],v.x=o,v.y=n,v.score=r,++u,++o,++m));return jsfeat.cache.put_buffer(e),u}}}();b.yape06=a}(jsfeat),function(a){var b=function(){var d=function(l,m,k){var h,n,j=0;for(h=k,n=0;h>n;n++,j++)h=Math.sqrt(k*k-n*n)+.5|0,m[j]=h+l*n;for(h--;n>h&&h>=0;h--,j++)n=Math.sqrt(k*k-h*h)+.5|0,m[j]=h+l*n;for(;n>-h;h--,j++)n=Math.sqrt(k*k-h*h)+.5|0,m[j]=h+l*n;for(n--;n>=0;n--,j++)h=-Math.sqrt(k*k-n*n)-.5|0,m[j]=h+l*n;for(;n>h;n--,j++)h=-Math.sqrt(k*k-n*n)-.5|0,m[j]=h+l*n;for(h++;0>=h;h++,j++)n=-Math.sqrt(k*k-h*h)-.5|0,m[j]=h+l*n;for(;-n>h;h++,j++)n=-Math.sqrt(k*k-h*h)-.5|0,m[j]=h+l*n;for(n++;0>n;n++,j++)h=Math.sqrt(k*k-n*n)+.5|0,m[j]=h+l*n;return m[j]=m[0],m[j+1]=m[1],j},g=function(h,j,i){var k=0;return 0!=h[j+1]&&k++,0!=h[j-1]&&k++,0!=h[j+i]&&k++,0!=h[j+i+1]&&k++,0!=h[j+i-1]&&k++,0!=h[j-i]&&k++,0!=h[j-i+1]&&k++,0!=h[j-i-1]&&k++,k},c=function(l,m,i,k,j){var h,n;if(i>0)for(m-=k*j,n=-j;j>=n;++n){for(h=-j;j>=h;++h)if(l[m+h]>i)return!1;m+=k}else for(m-=k*j,n=-j;j>=n;++n){for(h=-j;j>=h;++h)if(l[m+h]<i)return!1;m+=k}return!0},e=function(s,r,m,u,p,i,l,n){var k=0,q=0,o=l-1|0,j=0,w=0,v=0,t=0,h=0;if(j=s[r+i[q]],p>=j)if(j>=u)if(w=s[r+i[o]],p>=w){if(w>=u)return void(m[r]=0);if(o++,v=s[r+i[o]],v>p)if(o++,t=s[r+i[o]],t>p)h=3;else{if(!(u>t))return void(m[r]=0);h=6}else if(o++,t=s[r+i[o]],t>p)h=7;else{if(!(u>t))return void(m[r]=0);h=2}}else if(o++,v=s[r+i[o]],v>p)if(o++,t=s[r+i[o]],t>p)h=3;else{if(!(u>t))return void(m[r]=0);h=6}else{if(!(u>v))return void(m[r]=0);if(o++,t=s[r+i[o]],t>p)h=7;else{if(!(u>t))return void(m[r]=0);h=2}}else{if(w=s[r+i[o]],w>p)return void(m[r]=0);if(o++,v=s[r+i[o]],v>p)return void(m[r]=0);if(o++,t=s[r+i[o]],t>p)return void(m[r]=0);h=1}else{if(w=s[r+i[o]],u>w)return void(m[r]=0);if(o++,v=s[r+i[o]],u>v)return void(m[r]=0);if(o++,t=s[r+i[o]],u>t)return void(m[r]=0);h=0}for(q=1;l>=q;q++)switch(j=s[r+i[q]],h){case 0:if(j>p){if(v=t,o++,t=s[r+i[o]],u>t)return void(m[r]=0);k-=j+v,h=0;break}if(u>j){if(v>p)return void(m[r]=0);if(t>p)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],t>p)return void(m[r]=0);k-=j+v,h=8;break}if(p>=v)return void(m[r]=0);if(p>=t)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],t>p){k-=j+v,h=3;break}if(u>t){k-=j+v,h=6;break}return void(m[r]=0);case 1:if(u>j){if(v=t,o++,t=s[r+i[o]],t>p)return void(m[r]=0);k-=j+v,h=1;break}if(j>p){if(u>v)return void(m[r]=0);if(u>t)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],u>t)return void(m[r]=0);k-=j+v,h=9;break}if(v>=u)return void(m[r]=0);if(t>=u)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],u>t){k-=j+v,h=2;break}if(t>p){k-=j+v,h=7;break}return void(m[r]=0);case 2:if(j>p)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],u>j){if(t>p)return void(m[r]=0);k-=j+v,h=4;break}if(t>p){k-=j+v,h=7;break}if(u>t){k-=j+v,h=2;break}return void(m[r]=0);case 3:if(u>j)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],j>p){if(u>t)return void(m[r]=0);k-=j+v,h=5;break}if(t>p){k-=j+v,h=3;break}if(u>t){k-=j+v,h=6;break}return void(m[r]=0);case 4:if(j>p)return void(m[r]=0);if(u>j){if(v=t,o++,t=s[r+i[o]],t>p)return void(m[r]=0);k-=j+v,h=1;break}if(t>=u)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],u>t){k-=j+v,h=2;break}if(t>p){k-=j+v,h=7;break}return void(m[r]=0);case 5:if(u>j)return void(m[r]=0);if(j>p){if(v=t,o++,t=s[r+i[o]],u>t)return void(m[r]=0);k-=j+v,h=0;break}if(p>=t)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],t>p){k-=j+v,h=3;break}if(u>t){k-=j+v,h=6;break}return void(m[r]=0);case 7:if(j>p)return void(m[r]=0);if(u>j)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],t>p){k-=j+v,h=3;break}if(u>t){k-=j+v,h=6;break}return void(m[r]=0);case 6:if(j>p)return void(m[r]=0);if(u>j)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],u>t){k-=j+v,h=2;break}if(t>p){k-=j+v,h=7;break}return void(m[r]=0);case 8:if(j>p){if(u>t)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],u>t)return void(m[r]=0);k-=j+v,h=9;break}if(u>j){if(v=t,o++,t=s[r+i[o]],t>p)return void(m[r]=0);k-=j+v,h=1;break}return void(m[r]=0);case 9:if(u>j){if(t>p)return void(m[r]=0);if(v=t,o++,t=s[r+i[o]],t>p)return void(m[r]=0);k-=j+v,h=8;break}if(j>p){if(v=t,o++,t=s[r+i[o]],u>t)return void(m[r]=0);k-=j+v,h=0;break}return void(m[r]=0)}m[r]=k+n*s[r]},f=function(){function h(i,j,k){this.dirs=new Int32Array(1024),this.dirs_count=0|d(i,this.dirs,k),this.scores=new Int32Array(i*j),this.radius=0|k}return h}();return{level_tables:[],tau:7,init:function(m,j,h,l){"undefined"==typeof l&&(l=1);var k;for(h=Math.min(h,7),h=Math.max(h,3),k=0;l>k;++k)this.level_tables[k]=new f(m>>k,j>>k,h)},detect:function(k,J,G){"undefined"==typeof G&&(G=4);var E,A=this.level_tables[0],i=0|A.radius,q=i-1|0,m=A.dirs,n=0|A.dirs_count,v=n>>1,O=k.data,u=0|k.cols,K=0|k.rows,N=u>>1,H=A.scores,s=0,r=0,j=0,l=0,o=0,p=0,z=0,I=0,F=0|this.tau,D=0,C=0|Math.max(i+1,G),B=0|Math.max(i+1,G),M=0|Math.min(u-i-2,u-G),L=0|Math.min(K-i-2,K-G);for(j=B*u+C|0,r=B;L>r;++r,j+=u)for(s=C,l=j;M>s;++s,++l)o=O[l]+F,p=O[l]-F,p<O[l+i]&&O[l+i]<o&&p<O[l-i]&&O[l-i]<o?H[l]=0:e(O,l,H,p,o,m,v,n);for(j=B*u+C|0,r=B;L>r;++r,j+=u)for(s=C,l=j;M>s;++s,++l)I=H[l],z=Math.abs(I),5>z?(++s,++l):g(H,l,u)>=3&&c(H,l,I,N,i)&&(E=J[D],E.x=s,E.y=r,E.score=z,++D,s+=q,l+=q);return D}}}();a.yape=b}(jsfeat),function(b){var a=function(){var d=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),c=new jsfeat.matrix_t(3,3,jsfeat.F32_t|jsfeat.C1_t),f=new jsfeat.matrix_t(32,32,jsfeat.U8_t|jsfeat.C1_t),e=function(l,n,k,i,h,j){var m=Math.cos(k),g=Math.sin(k);c.data[0]=m,c.data[1]=-g,c.data[2]=(-m+g)*j*.5+i,c.data[3]=g,c.data[4]=m,c.data[5]=(-g-m)*j*.5+h,jsfeat.imgproc.warp_affine(l,n,c,128)};return{describe:function(j,u,g,B){var r=32,x=0,A=0,q=0,p=0,z=0,o=0,m=0,D=0,t=(j.data,j.cols,j.rows,f.data),v=528,k=0;B.type&jsfeat.U8_t?B.resize(r,g,1):(B.type=jsfeat.U8_t,B.cols=r,B.rows=g,B.channel=1,B.allocate());var l=B.data,s=0;for(x=0;g>x;++x){for(q=u[x].x,p=u[x].y,z=u[x].angle,e(j,f,z,q,p,32),k=0,A=0;r>A;++A)o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D=m>o|0,o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D|=(m>o)<<1,o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D|=(m>o)<<2,o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D|=(m>o)<<3,o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D|=(m>o)<<4,o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D|=(m>o)<<5,o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D|=(m>o)<<6,o=t[v+32*d[k+1]+d[k]],k+=2,m=t[v+32*d[k+1]+d[k]],k+=2,D|=(m>o)<<7,l[s+A]=D;s+=r}}}}();b.orb=a}(jsfeat),function(b){var a=function(){var c=jsfeat.imgproc.scharr_derivatives;return{track:function(n,u,ap,aL,k,N,R,K,f,q){"undefined"==typeof R&&(R=30),"undefined"==typeof K&&(K=new Uint8Array(k)),"undefined"==typeof f&&(f=.01),"undefined"==typeof q&&(q=1e-4);var e=.5*(N-1),h=N*N|0,aa=h<<1,r=n.data,S=u.data,g=r[0].data,F=S[0].data,M=r[0].cols,aB=r[0].rows,ay=0,aH=0,az=jsfeat.cache.get_buffer(h<<2),s=jsfeat.cache.get_buffer(aa<<2),t=jsfeat.cache.get_buffer(aB*(M<<1)<<2),V=new jsfeat.matrix_t(M,aB,jsfeat.S32C2_t,t.data),w=az.i32,ac=s.i32,aA=t.i32,ab=0,I=0,aM=0,at=0,aI=0,au=0,am=0,aF=0,aD=0,af=0,ae=0,E=0,z=0,Y=0,W=0,p=0,o=0,aE=0,aC=0,Q=0,P=0,J=0,H=0,ai=0,ak=0,l=0,d=0,A=0,O=0,U=0,T=0,aw=0,av=0,ah=14,C=14,Z=C-5,ax=1<<Z-1,ad=1<<ah,m=1<<C-1,X=1/(1<<20),aK=0,aJ=0,ar=0,aq=0,al=0,v=0,B=0,ao=0,an=0,ag=0,aj=0,aG=0,G=1.1920929e-7;for(f*=f;k>Q;++Q)K[Q]=1;var L=n.levels-1|0;for(ai=L;ai>=0;--ai)for(am=1/(1<<ai),ay=M>>ai,aH=aB>>ai,ab=ay<<1,g=r[ai].data,F=S[ai].data,A=ay-N|0,O=aH-N|0,c(r[ai],V),ak=0;k>ak;++ak)if(Q=ak<<1,P=Q+1,aF=ap[Q]*am,aD=ap[P]*am,ai==L?(af=aF,ae=aD):(af=2*aL[Q],ae=2*aL[P]),aL[Q]=af,aL[P]=ae,aF-=e,aD-=e,p=0|aF,o=0|aD,J=d>=p|p>=A|d>=o|o>=O,0==J){for(U=aF-p,T=aD-o,aK=(1-U)*(1-T)*ad+.5|0,aJ=U*(1-T)*ad+.5|0,ar=(1-U)*T*ad+.5|0,aq=ad-aK-aJ-ar,ao=0,an=0,ag=0,H=0;N>H;++H)for(I=(H+o)*ay+p|0,aM=I<<1,at=H*N|0,aI=at<<1,J=0;N>J;++J,++I,++at,aM+=2)al=g[I]*aK+g[I+1]*aJ+g[I+ay]*ar+g[I+ay+1]*aq,al=al+ax>>Z,v=aA[aM]*aK+aA[aM+2]*aJ+aA[aM+ab]*ar+aA[aM+ab+2]*aq,v=v+m>>C,B=aA[aM+1]*aK+aA[aM+3]*aJ+aA[aM+ab+1]*ar+aA[aM+ab+3]*aq,B=B+m>>C,w[at]=al,ac[aI++]=v,ac[aI++]=B,ao+=v*v,an+=v*B,ag+=B*B;if(ao*=X,
an*=X,ag*=X,aj=ao*ag-an*an,aG=(ag+ao-Math.sqrt((ao-ag)*(ao-ag)+4*an*an))/aa,q>aG||G>aj)0==ai&&(K[ak]=0);else for(aj=1/aj,af-=e,ae-=e,E=0,z=0,l=0;R>l;++l){if(aE=0|af,aC=0|ae,J=d>=aE|aE>=A|d>=aC|aC>=O,0!=J){0==ai&&(K[ak]=0);break}for(U=af-aE,T=ae-aC,aK=(1-U)*(1-T)*ad+.5|0,aJ=U*(1-T)*ad+.5|0,ar=(1-U)*T*ad+.5|0,aq=ad-aK-aJ-ar,aw=0,av=0,H=0;N>H;++H)for(au=(H+aC)*ay+aE|0,at=H*N|0,aI=at<<1,J=0;N>J;++J,++au,++at)al=F[au]*aK+F[au+1]*aJ+F[au+ay]*ar+F[au+ay+1]*aq,al=al+ax>>Z,al-=w[at],aw+=al*ac[aI++],av+=al*ac[aI++];if(aw*=X,av*=X,Y=(an*av-ag*aw)*aj,W=(an*aw-ao*av)*aj,af+=Y,ae+=W,aL[Q]=af+e,aL[P]=ae+e,f>=Y*Y+W*W)break;if(l>0&&Math.abs(Y+E)<.01&&Math.abs(W+z)<.01){aL[Q]-=.5*Y,aL[P]-=.5*W;break}E=Y,z=W}}else 0==ai&&(K[ak]=0);jsfeat.cache.put_buffer(az),jsfeat.cache.put_buffer(s),jsfeat.cache.put_buffer(t)}}}();b.optical_flow_lk=a}(jsfeat),function(b){var a=function(){var c=function(e,d){var f=.25*e.width+.5|0;return d.x<=e.x+f&&d.x>=e.x-f&&d.y<=e.y+f&&d.y>=e.y-f&&d.width<=1.5*e.width+.5|0&&1.5*d.width+.5|0>=e.width};return{edges_density:.07,detect_single_scale:function(E,ad,af,q,d,f,D,B){var Z,X,W,Q,O,w,p,r,S,t,o,l,u,s,ae,A,L,h,n,G,m,M,K,J,v,C,z=B.size[0]*D|0,N=B.size[1]*D|0,V=.5*D+1.5|0,U=V,T=d-z|0,R=f-N|0,H=d+1|0,e=1/(z*N),g=!0,ac=0,ab=z,aa=N*H,Y=aa+z,F=z*N*255*this.edges_density|0,P=[];for(O=0;R>O;O+=U)for(ac=O*H,Q=0;T>Q;Q+=V,ac+=V)if(p=E[ac]-E[ac+ab]-E[ac+aa]+E[ac+Y],q&&(w=q[ac]-q[ac+ab]-q[ac+aa]+q[ac+Y],F>w||20>p))Q+=V,ac+=V;else{for(p*=e,r=(ad[ac]-ad[ac+ab]-ad[ac+aa]+ad[ac+Y])*e-p*p,S=r>0?Math.sqrt(r):1,t=B.complexClassifiers,s=t.length,g=!0,Z=0;s>Z;++Z){for(o=t[Z],L=o.threshold,l=o.simpleClassifiers,ae=l.length,h=0,X=0;ae>X;++X){if(u=l[X],n=0,m=u.features,A=m.length,1===u.tilted)for(W=0;A>W;++W)G=m[W],M=~~(Q+G[0]*D)+~~(O+G[1]*D)*H,v=~~(G[2]*D),C=~~(G[3]*D),K=v*H,J=C*H,n+=(af[M]-af[M+v+K]-af[M-C+J]+af[M+v-C+K+J])*G[4];else for(W=0;A>W;++W)G=m[W],M=~~(Q+G[0]*D)+~~(O+G[1]*D)*H,v=~~(G[2]*D),C=~~(G[3]*D),J=C*H,n+=(E[M]-E[M+v]-E[M+J]+E[M+J+v])*G[4];h+=n*e<u.threshold*S?u.left_val:u.right_val}if(L>h){g=!1;break}}g&&(P.push({x:Q,y:O,width:z,height:N,neighbor:1,confidence:h}),Q+=V,ac+=V)}return P},detect_multi_scale:function(e,m,f,h,d,n,i,g,k){"undefined"==typeof g&&(g=1.2),"undefined"==typeof k&&(k=1);for(var o=i.size[0],j=i.size[1],l=[];d>k*o&&n>k*j;)l=l.concat(this.detect_single_scale(e,m,f,h,d,n,k,i)),k*=g;return l},group_rectangles:function(g,l){"undefined"==typeof l&&(l=1);var y,v,q=g.length,r=[];for(y=0;q>y;++y)r[y]={parent:-1,element:g[y],rank:0};for(y=0;q>y;++y)if(r[y].element){for(var t=y;-1!=r[t].parent;)t=r[t].parent;for(v=0;q>v;++v)if(y!=v&&r[v].element&&c(r[y].element,r[v].element)){for(var s=v;-1!=r[s].parent;)s=r[s].parent;if(s!=t){r[t].rank>r[s].rank?r[s].parent=t:(r[t].parent=s,r[t].rank==r[s].rank&&r[s].rank++,t=s);for(var A,d=v;-1!=r[d].parent;)A=d,d=r[d].parent,r[A].parent=t;for(d=y;-1!=r[d].parent;)A=d,d=r[d].parent,r[A].parent=t}}}var w=[],o=0;for(y=0;q>y;y++){v=-1;var e=y;if(r[e].element){for(;-1!=r[e].parent;)e=r[e].parent;r[e].rank>=0&&(r[e].rank=~o++),v=~r[e].rank}w[y]=v}var m=[];for(y=0;o+1>y;++y)m[y]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(y=0;q>y;++y){var z=g[y],k=w[y];0==m[k].neighbors&&(m[k].confidence=z.confidence),++m[k].neighbors,m[k].x+=z.x,m[k].y+=z.y,m[k].width+=z.width,m[k].height+=z.height,m[k].confidence=Math.max(m[k].confidence,z.confidence)}var h=[];for(y=0;o>y;++y)q=m[y].neighbors,q>=l&&h.push({x:(2*m[y].x+q)/(2*q),y:(2*m[y].y+q)/(2*q),width:(2*m[y].width+q)/(2*q),height:(2*m[y].height+q)/(2*q),neighbors:m[y].neighbors,confidence:m[y].confidence});var p=[];for(q=h.length,y=0;q>y;++y){var z=h[y],x=!0;for(v=0;q>v;++v){var u=h[v],f=.25*u.width+.5|0;if(y!=v&&z.x>=u.x-f&&z.y>=u.y-f&&z.x+z.width<=u.x+u.width+f&&z.y+z.height<=u.y+u.height+f&&(u.neighbors>Math.max(3,z.neighbors)||z.neighbors<3)){x=!1;break}}x&&p.push(z)}return p}}}();b.haar=a}(jsfeat),function(a){var b=function(){var c=function(f,e){var g=.25*f.width+.5|0;return e.x<=f.x+g&&e.x>=f.x-g&&e.y<=f.y+g&&e.y>=f.y-g&&e.width<=1.5*f.width+.5|0&&1.5*e.width+.5|0>=f.width},d=new jsfeat.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(g){for(var m=g.stage_classifier.length,h=0;m>h;h++)for(var l=g.stage_classifier[h].feature,e=g.stage_classifier[h].count,i=g.stage_classifier[h]._feature=new Array(e),f=0;e>f;f++)i[f]={size:l[f].size,px:new Array(l[f].size),pz:new Array(l[f].size),nx:new Array(l[f].size),nz:new Array(l[f].size)}},build_pyramid:function(e,k,s,f){"undefined"==typeof f&&(f=4);var q=e.cols,m=e.rows,l=0,n=0,h=0,p=!1,j=e,g=e,r=jsfeat.U8_t|jsfeat.C1_t;this.interval=f,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(q/k,m/s))/Math.log(this.scale)|0;var o=4*(this.scale_to+2*this.next)|0;for(d.levels!=o&&(d.levels=o,d.data=new Array(o),p=!0,d.data[0]=e),l=1;l<=this.interval;++l)n=q/Math.pow(this.scale,l)|0,h=m/Math.pow(this.scale,l)|0,j=d.data[l<<2],(p||n!=j.cols||h!=j.rows)&&(d.data[l<<2]=new jsfeat.matrix_t(n,h,r),j=d.data[l<<2]),jsfeat.imgproc.resample(e,j,n,h);for(l=this.next;l<this.scale_to+2*this.next;++l)g=d.data[(l<<2)-(this.next<<2)],j=d.data[l<<2],n=g.cols>>1,h=g.rows>>1,(p||n!=j.cols||h!=j.rows)&&(d.data[l<<2]=new jsfeat.matrix_t(n,h,r),j=d.data[l<<2]),jsfeat.imgproc.pyrdown(g,j);for(l=2*this.next;l<this.scale_to+2*this.next;++l)g=d.data[(l<<2)-(this.next<<2)],n=g.cols>>1,h=g.rows>>1,j=d.data[(l<<2)+1],(p||n!=j.cols||h!=j.rows)&&(d.data[(l<<2)+1]=new jsfeat.matrix_t(n,h,r),j=d.data[(l<<2)+1]),jsfeat.imgproc.pyrdown(g,j,1,0),j=d.data[(l<<2)+2],(p||n!=j.cols||h!=j.rows)&&(d.data[(l<<2)+2]=new jsfeat.matrix_t(n,h,r),j=d.data[(l<<2)+2]),jsfeat.imgproc.pyrdown(g,j,0,1),j=d.data[(l<<2)+3],(p||n!=j.cols||h!=j.rows)&&(d.data[(l<<2)+3]=new jsfeat.matrix_t(n,h,r),j=d.data[(l<<2)+3]),jsfeat.imgproc.pyrdown(g,j,1,1);return d},detect:function(G,L){var X,Q,D,H,F,N=(this.interval,this.scale),m=this.next,l=this.scale_to,ab=0,aa=0,Z=0,W=0,S=0,R=0,U=0,B=0,J=0,I=0,V=0,ae=0,M=0,ad=0,w=0,Y=0,g=0,E=0,O=!0,o=!0,z=1,v=1,s=[0,1,0,1],r=[0,0,1,1],K=[],C=G.data,ac=1,u=2,t=4,A=[],e=[0,0,0],P=[0,0,0],T=[0,0,0];for(ab=0;l>ab;ab++){for(w=ab<<2,Y=C[w+(m<<3)].cols-(L.width>>2),g=C[w+(m<<3)].rows-(L.height>>2),P[0]=C[w].cols*ac,P[1]=C[w+(m<<2)].cols*ac,P[2]=C[w+(m<<3)].cols*ac,T[0]=C[w].cols*t-Y*t,T[1]=C[w+(m<<2)].cols*u-Y*u,T[2]=C[w+(m<<3)].cols*ac-Y*ac,B=L.stage_classifier.length,aa=0;B>aa;aa++)for(D=L.stage_classifier[aa].feature,Q=L.stage_classifier[aa]._feature,J=L.stage_classifier[aa].count,Z=0;J>Z;Z++)for(H=Q[Z],F=D[Z],I=0|F.size,U=0;I>U;U++)H.px[U]=F.px[U]*ac+F.py[U]*P[F.pz[U]],H.pz[U]=F.pz[U],H.nx[U]=F.nx[U]*ac+F.ny[U]*P[F.nz[U]],H.nz[U]=F.nz[U];for(A[0]=C[w].data,A[1]=C[w+(m<<2)].data,U=0;4>U;U++)for(A[2]=C[w+(m<<3)+U].data,e[0]=s[U]*u+r[U]*(C[w].cols*u),e[1]=s[U]*ac+r[U]*(C[w+(m<<2)].cols*ac),e[2]=0,R=0;g>R;R++){for(S=0;Y>S;S++){for(E=0,O=!0,B=L.stage_classifier.length,aa=0;B>aa;aa++){for(E=0,X=L.stage_classifier[aa].alpha,Q=L.stage_classifier[aa]._feature,J=L.stage_classifier[aa].count,Z=0;J>Z;Z++)if(H=Q[Z],ae=A[H.pz[0]][e[H.pz[0]]+H.px[0]],M=A[H.nz[0]][e[H.nz[0]]+H.nx[0]],M>=ae)E+=X[Z<<1];else{for(o=!0,I=H.size,ad=1;I>ad;ad++){if(H.pz[ad]>=0&&(V=A[H.pz[ad]][e[H.pz[ad]]+H.px[ad]],ae>V)){if(M>=V){o=!1;break}ae=V}if(H.nz[ad]>=0&&(W=A[H.nz[ad]][e[H.nz[ad]]+H.nx[ad]],W>M)){if(W>=ae){o=!1;break}M=W}}E+=o?X[(Z<<1)+1]:X[Z<<1]}if(E<L.stage_classifier[aa].threshold){O=!1;break}}O&&(K.push({x:(4*S+2*s[U])*z,y:(4*R+2*r[U])*v,width:L.width*z,height:L.height*v,neighbor:1,confidence:E}),++S,e[0]+=t,e[1]+=u,e[2]+=ac),e[0]+=t,e[1]+=u,e[2]+=ac}e[0]+=T[0],e[1]+=T[1],e[2]+=T[2]}z*=N,v*=N}return K},group_rectangles:function(h,m){"undefined"==typeof m&&(m=1);var z,w,r=h.length,s=[];for(z=0;r>z;++z)s[z]={parent:-1,element:h[z],rank:0};for(z=0;r>z;++z)if(s[z].element){for(var u=z;-1!=s[u].parent;)u=s[u].parent;for(w=0;r>w;++w)if(z!=w&&s[w].element&&c(s[z].element,s[w].element)){for(var t=w;-1!=s[t].parent;)t=s[t].parent;if(t!=u){s[u].rank>s[t].rank?s[t].parent=u:(s[u].parent=t,s[u].rank==s[t].rank&&s[t].rank++,u=t);for(var B,e=w;-1!=s[e].parent;)B=e,e=s[e].parent,s[B].parent=u;for(e=z;-1!=s[e].parent;)B=e,e=s[e].parent,s[B].parent=u}}}var x=[],p=0;for(z=0;r>z;z++){w=-1;var f=z;if(s[f].element){for(;-1!=s[f].parent;)f=s[f].parent;s[f].rank>=0&&(s[f].rank=~p++),w=~s[f].rank}x[z]=w}var o=[];for(z=0;p+1>z;++z)o[z]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(z=0;r>z;++z){var A=h[z],l=x[z];0==o[l].neighbors&&(o[l].confidence=A.confidence),++o[l].neighbors,o[l].x+=A.x,o[l].y+=A.y,o[l].width+=A.width,o[l].height+=A.height,o[l].confidence=Math.max(o[l].confidence,A.confidence)}var k=[];for(z=0;p>z;++z)r=o[z].neighbors,r>=m&&k.push({x:(2*o[z].x+r)/(2*r),y:(2*o[z].y+r)/(2*r),width:(2*o[z].width+r)/(2*r),height:(2*o[z].height+r)/(2*r),neighbors:o[z].neighbors,confidence:o[z].confidence});var q=[];for(r=k.length,z=0;r>z;++z){var A=k[z],y=!0;for(w=0;r>w;++w){var v=k[w],g=.25*v.width+.5|0;if(z!=w&&A.x>=v.x-g&&A.y>=v.y-g&&A.x+A.width<=v.x+v.width+g&&A.y+A.height<=v.y+v.height+g&&(v.neighbors>Math.max(3,A.neighbors)||A.neighbors<3)){y=!1;break}}y&&q.push(A)}return q}}}();a.bbf=b}(jsfeat),function(a){"undefined"==typeof module||"undefined"==typeof module.exports?window.jsfeat=a:module.exports=a}(jsfeat),function(){"use strict";function Plugin(darkroom,options){this.darkroom=darkroom,this.options=Darkroom.Utils.extend(options,this.defaults),this.initialize()}Darkroom.Plugin=Plugin,Plugin.prototype={defaults:{},initialize:function(){}},Plugin.extend=function(protoProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},Darkroom.Utils.extend(child,parent);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&Darkroom.Utils.extend(child.prototype,protoProps),child.__super__=parent.prototype,child}}(),function(){"use strict";function Transformation(options){this.options=options}Darkroom.Transformation=Transformation,Transformation.prototype={applyTransformation:function(image){}},Transformation.extend=function(protoProps){var child,parent=this;child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},Darkroom.Utils.extend(child,parent);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&Darkroom.Utils.extend(child.prototype,protoProps),child.__super__=parent.prototype,child}}(),function(){"use strict";function Toolbar(element){this.element=element}function ButtonGroup(element){this.element=element}function Button(element){this.element=element}Darkroom.UI={Toolbar:Toolbar,ButtonGroup:ButtonGroup,Button:Button},Toolbar.prototype={createButtonGroup:function(options){var buttonGroup=document.createElement("div");return buttonGroup.className="darkroom-button-group",this.element.appendChild(buttonGroup),new ButtonGroup(buttonGroup)}},ButtonGroup.prototype={createButton:function(options){var defaults={image:"help",type:"default",group:"default",hide:!1,disabled:!1};options=Darkroom.Utils.extend(options,defaults);var buttonElement=document.createElement("button");buttonElement.type="button",buttonElement.className="darkroom-button darkroom-button-"+options.type,buttonElement.innerHTML='<svg class="darkroom-icon"><use xlink:href="#'+options.image+'" /></svg>',buttonElement.title=options.tooltip,this.element.appendChild(buttonElement);var button=new Button(buttonElement);return button.hide(options.hide),button.disable(options.disabled),button}},Button.prototype={addEventListener:function(eventName,listener){this.element.addEventListener?this.element.addEventListener(eventName,listener):this.element.attachEvent&&this.element.attachEvent("on"+eventName,listener)},removeEventListener:function(eventName,listener){this.element.removeEventListener&&this.element.removeEventListener(eventName,listener)},active:function(value){value?this.element.classList.add("darkroom-button-active"):this.element.classList.remove("darkroom-button-active")},hide:function(value){value?this.element.classList.add("darkroom-button-hidden"):this.element.classList.remove("darkroom-button-hidden")},disable:function(value){this.element.disabled=!!value}}}(),function(){"use strict";function extend(b,a){var prop;if(void 0===b)return a;for(prop in a)a.hasOwnProperty(prop)&&b.hasOwnProperty(prop)===!1&&(b[prop]=a[prop]);return b}function computeImageViewPort(image){return{height:Math.abs(image.getWidth()*Math.sin(image.getAngle()*Math.PI/180))+Math.abs(image.getHeight()*Math.cos(image.getAngle()*Math.PI/180)),width:Math.abs(image.getHeight()*Math.sin(image.getAngle()*Math.PI/180))+Math.abs(image.getWidth()*Math.cos(image.getAngle()*Math.PI/180))}}Darkroom.Utils={extend:extend,computeImageViewPort:computeImageViewPort}}(),function(window,document,Darkroom,fabric){"use strict";Darkroom.plugins.history=Darkroom.Plugin.extend({undoTransformations:[],initialize:function(){this._initButtons(),this.darkroom.addEventListener("core:transformation",this._onTranformationApplied.bind(this))},undo:function(){if(0!==this.darkroom.transformations.length){var lastTransformation=this.darkroom.transformations.pop();this.undoTransformations.unshift(lastTransformation),this.darkroom.reinitializeImage(),this._updateButtons()}},redo:function(){if(0!==this.undoTransformations.length){var cancelTransformation=this.undoTransformations.shift();this.darkroom.transformations.push(cancelTransformation),this.darkroom.reinitializeImage(),this._updateButtons()}},_initButtons:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();return this.backButton=buttonGroup.createButton({image:"undo",tooltip:"Undo",disabled:!0}),this.forwardButton=buttonGroup.createButton({image:"redo",tooltip:"Redo",disabled:!0}),this.backButton.addEventListener("click",this.undo.bind(this)),this.forwardButton.addEventListener("click",this.redo.bind(this)),this},_updateButtons:function(){this.backButton.disable(0===this.darkroom.transformations.length),this.forwardButton.disable(0===this.undoTransformations.length)},_onTranformationApplied:function(){this.undoTransformations=[],this._updateButtons()}})}(window,document,Darkroom,fabric),function(){"use strict";var Crop=Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){var snapshot=new Image;snapshot.onload=function(){if(!(1>height||1>width)){var imgInstance=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),width=this.width,height=this.height;canvas.setWidth(width),canvas.setHeight(height),image.remove(),canvas.add(imgInstance),next(imgInstance)}};var viewport=Darkroom.Utils.computeImageViewPort(image),imageWidth=viewport.width,imageHeight=viewport.height,left=this.options.left*imageWidth,top=this.options.top*imageHeight,width=Math.min(this.options.width*imageWidth,imageWidth-left),height=Math.min(this.options.height*imageHeight,imageHeight-top);snapshot.src=canvas.toDataURL({left:left,top:top,width:width,height:height})}}),CropZone=fabric.util.createClass(fabric.Rect,{_render:function(ctx){this.callSuper("_render",ctx);var dashWidth=(ctx.canvas,7),flipX=this.flipX?-1:1,flipY=this.flipY?-1:1,scaleX=flipX/this.scaleX,scaleY=flipY/this.scaleY;ctx.scale(scaleX,scaleY),ctx.fillStyle="rgba(0, 0, 0, 0.5)",this._renderOverlay(ctx),void 0!==ctx.setLineDash?ctx.setLineDash([dashWidth,dashWidth]):void 0!==ctx.mozDash&&(ctx.mozDash=[dashWidth,dashWidth]),ctx.strokeStyle="rgba(0, 0, 0, 0.2)",this._renderBorders(ctx),this._renderGrid(ctx),ctx.lineDashOffset=dashWidth,ctx.strokeStyle="rgba(255, 255, 255, 0.4)",this._renderBorders(ctx),this._renderGrid(ctx),ctx.scale(1/scaleX,1/scaleY)},_renderOverlay:function(ctx){var canvas=ctx.canvas,x0=Math.ceil(-this.getWidth()/2-this.getLeft()),x1=Math.ceil(-this.getWidth()/2),x2=Math.ceil(this.getWidth()/2),x3=Math.ceil(this.getWidth()/2+(canvas.width-this.getWidth()-this.getLeft())),y0=Math.ceil(-this.getHeight()/2-this.getTop()),y1=Math.ceil(-this.getHeight()/2),y2=Math.ceil(this.getHeight()/2),y3=Math.ceil(this.getHeight()/2+(canvas.height-this.getHeight()-this.getTop()));ctx.beginPath(),ctx.moveTo(x0-1,y0-1),ctx.lineTo(x3+1,y0-1),ctx.lineTo(x3+1,y3+1),ctx.lineTo(x0-1,y3-1),ctx.lineTo(x0-1,y0-1),ctx.closePath(),ctx.moveTo(x1,y1),ctx.lineTo(x1,y2),ctx.lineTo(x2,y2),ctx.lineTo(x2,y1),ctx.lineTo(x1,y1),ctx.closePath(),ctx.fill()},_renderBorders:function(ctx){ctx.beginPath(),ctx.moveTo(-this.getWidth()/2,-this.getHeight()/2),ctx.lineTo(this.getWidth()/2,-this.getHeight()/2),ctx.lineTo(this.getWidth()/2,this.getHeight()/2),ctx.lineTo(-this.getWidth()/2,this.getHeight()/2),ctx.lineTo(-this.getWidth()/2,-this.getHeight()/2),ctx.stroke()},_renderGrid:function(ctx){ctx.beginPath(),ctx.moveTo(-this.getWidth()/2+1/3*this.getWidth(),-this.getHeight()/2),ctx.lineTo(-this.getWidth()/2+1/3*this.getWidth(),this.getHeight()/2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(-this.getWidth()/2+2/3*this.getWidth(),-this.getHeight()/2),ctx.lineTo(-this.getWidth()/2+2/3*this.getWidth(),this.getHeight()/2),ctx.stroke(),ctx.beginPath(),ctx.moveTo(-this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),ctx.lineTo(this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),ctx.stroke(),ctx.beginPath(),ctx.moveTo(-this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),ctx.lineTo(this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),ctx.stroke()}});Darkroom.plugins.crop=Darkroom.Plugin.extend({startX:null,startY:null,isKeyCroping:!1,isKeyLeft:!1,isKeyUp:!1,defaults:{minHeight:1,minWidth:1,ratio:null,quickCropKey:!1},initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.cropButton=buttonGroup.createButton({image:"crop",tooltip:"Crop image"}),this.okButton=buttonGroup.createButton({image:"done",type:"success",tooltip:"Apply",hide:!0}),this.cancelButton=buttonGroup.createButton({image:"close",type:"danger",tooltip:"Cancel",hide:!0}),this.cropButton.addEventListener("click",this.toggleCrop.bind(this)),this.okButton.addEventListener("click",this.cropCurrentZone.bind(this)),this.cancelButton.addEventListener("click",this.releaseFocus.bind(this)),this.darkroom.canvas.on("mouse:down",this.onMouseDown.bind(this)),this.darkroom.canvas.on("mouse:move",this.onMouseMove.bind(this)),this.darkroom.canvas.on("mouse:up",this.onMouseUp.bind(this)),this.darkroom.canvas.on("object:moving",this.onObjectMoving.bind(this)),this.darkroom.canvas.on("object:scaling",this.onObjectScaling.bind(this)),fabric.util.addListener(fabric.document,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(fabric.document,"keyup",this.onKeyUp.bind(this)),this.darkroom.addEventListener("core:transformation",this.releaseFocus.bind(this))},onObjectMoving:function(event){if(this.hasFocus()){var currentObject=event.target;if(currentObject===this.cropZone){var canvas=this.darkroom.canvas,x=currentObject.getLeft(),y=currentObject.getTop(),w=currentObject.getWidth(),h=currentObject.getHeight(),maxX=canvas.getWidth()-w,maxY=canvas.getHeight()-h;0>x&&currentObject.set("left",0),0>y&&currentObject.set("top",0),x>maxX&&currentObject.set("left",maxX),y>maxY&&currentObject.set("top",maxY),this.darkroom.dispatchEvent("crop:update")}}},onObjectScaling:function(event){if(this.hasFocus()){var preventScaling=!1,currentObject=event.target;if(currentObject===this.cropZone){var canvas=this.darkroom.canvas,pointer=canvas.getPointer(event.e),minX=(pointer.x,pointer.y,currentObject.getLeft()),minY=currentObject.getTop(),maxX=currentObject.getLeft()+currentObject.getWidth(),maxY=currentObject.getTop()+currentObject.getHeight();if(null!==this.options.ratio&&(0>minX||maxX>canvas.getWidth()||0>minY||maxY>canvas.getHeight())&&(preventScaling=!0),0>minX||maxX>canvas.getWidth()||preventScaling){var lastScaleX=this.lastScaleX||1;currentObject.setScaleX(lastScaleX)}if(0>minX&&currentObject.setLeft(0),0>minY||maxY>canvas.getHeight()||preventScaling){var lastScaleY=this.lastScaleY||1;currentObject.setScaleY(lastScaleY)}0>minY&&currentObject.setTop(0),currentObject.getWidth()<this.options.minWidth&&currentObject.scaleToWidth(this.options.minWidth),currentObject.getHeight()<this.options.minHeight&&currentObject.scaleToHeight(this.options.minHeight),this.lastScaleX=currentObject.getScaleX(),this.lastScaleY=currentObject.getScaleY(),this.darkroom.dispatchEvent("crop:update")}}},onMouseDown:function(event){if(this.hasFocus()){var canvas=this.darkroom.canvas;canvas.calcOffset();var pointer=canvas.getPointer(event.e),x=pointer.x,y=pointer.y,point=new fabric.Point(x,y),activeObject=canvas.getActiveObject();activeObject===this.cropZone||this.cropZone.containsPoint(point)||(canvas.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.startX=x,this.startY=y)}},onMouseMove:function(event){if(this.isKeyCroping)return this.onMouseMoveKeyCrop(event);if(null!==this.startX&&null!==this.startY){var canvas=this.darkroom.canvas,pointer=canvas.getPointer(event.e),x=pointer.x,y=pointer.y;this._renderCropZone(this.startX,this.startY,x,y)}},onMouseMoveKeyCrop:function(event){var canvas=this.darkroom.canvas,zone=this.cropZone,pointer=canvas.getPointer(event.e),x=pointer.x,y=pointer.y;zone.left&&zone.top||(zone.setTop(y),zone.setLeft(x)),this.isKeyLeft=x<zone.left+zone.width/2,this.isKeyUp=y<zone.top+zone.height/2,this._renderCropZone(Math.min(zone.left,x),Math.min(zone.top,y),Math.max(zone.left+zone.width,x),Math.max(zone.top+zone.height,y))},onMouseUp:function(event){if(null!==this.startX&&null!==this.startY){var canvas=this.darkroom.canvas;this.cropZone.setCoords(),canvas.setActiveObject(this.cropZone),canvas.calcOffset(),this.startX=null,this.startY=null}},onKeyDown:function(event){!1===this.options.quickCropKey||event.keyCode!==this.options.quickCropKey||this.isKeyCroping||(this.isKeyCroping=!0,this.darkroom.canvas.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.cropZone.setTop(0),this.cropZone.setLeft(0))},onKeyUp:function(event){!1!==this.options.quickCropKey&&event.keyCode===this.options.quickCropKey&&this.isKeyCroping&&(this.isKeyCroping=!1,this.startX=1,this.startY=1,this.onMouseUp())},selectZone:function(x,y,width,height,forceDimension){this.hasFocus()||this.requireFocus(),forceDimension?this.cropZone.set({left:x,top:y,width:width,height:height}):this._renderCropZone(x,y,x+width,y+height);var canvas=this.darkroom.canvas;canvas.bringToFront(this.cropZone),this.cropZone.setCoords(),canvas.setActiveObject(this.cropZone),canvas.calcOffset(),this.darkroom.dispatchEvent("crop:update")},toggleCrop:function(){this.hasFocus()?this.releaseFocus():this.requireFocus()},cropCurrentZone:function(){if(this.hasFocus()&&!(this.cropZone.width<1&&this.cropZone.height<1)){var image=this.darkroom.image,top=this.cropZone.getTop()-image.getTop(),left=this.cropZone.getLeft()-image.getLeft(),width=this.cropZone.getWidth(),height=this.cropZone.getHeight();0>top&&(height+=top,top=0),0>left&&(width+=left,left=0),this.darkroom.applyTransformation(new Crop({top:top/image.getHeight(),left:left/image.getWidth(),width:width/image.getWidth(),height:height/image.getHeight()}))}},hasFocus:function(){return void 0!==this.cropZone},requireFocus:function(){this.cropZone=new CropZone({fill:"transparent",hasBorders:!1,originX:"left",originY:"top",cornerColor:"#444",cornerSize:8,transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1}),null!==this.options.ratio&&this.cropZone.set("lockUniScaling",!0),this.darkroom.canvas.add(this.cropZone),this.darkroom.canvas.defaultCursor="crosshair",this.cropButton.active(!0),this.okButton.hide(!1),this.cancelButton.hide(!1)},releaseFocus:function(){void 0!==this.cropZone&&(this.cropZone.remove(),this.cropZone=void 0,this.cropButton.active(!1),this.okButton.hide(!0),this.cancelButton.hide(!0),this.darkroom.canvas.defaultCursor="default",this.darkroom.dispatchEvent("crop:update"))},_renderCropZone:function(fromX,fromY,toX,toY){var canvas=this.darkroom.canvas,isRight=toX>fromX,isLeft=!isRight,isDown=toY>fromY,isUp=!isDown,minWidth=Math.min(+this.options.minWidth,canvas.getWidth()),minHeight=Math.min(+this.options.minHeight,canvas.getHeight()),leftX=Math.min(fromX,toX),rightX=Math.max(fromX,toX),topY=Math.min(fromY,toY),bottomY=Math.max(fromY,toY);leftX=Math.max(0,leftX),rightX=Math.min(canvas.getWidth(),rightX),topY=Math.max(0,topY),bottomY=Math.min(canvas.getHeight(),bottomY),minWidth>rightX-leftX&&(isRight?rightX=leftX+minWidth:leftX=rightX-minWidth),minHeight>bottomY-topY&&(isDown?bottomY=topY+minHeight:topY=bottomY-minHeight),0>leftX&&(rightX+=Math.abs(leftX),leftX=0),rightX>canvas.getWidth()&&(leftX-=rightX-canvas.getWidth(),rightX=canvas.getWidth()),0>topY&&(bottomY+=Math.abs(topY),topY=0),bottomY>canvas.getHeight()&&(topY-=bottomY-canvas.getHeight(),bottomY=canvas.getHeight());var width=rightX-leftX,height=bottomY-topY,currentRatio=width/height;if(this.options.ratio&&+this.options.ratio!==currentRatio){var ratio=+this.options.ratio;if(this.isKeyCroping&&(isLeft=this.isKeyLeft,isUp=this.isKeyUp),ratio>currentRatio){var newWidth=height*ratio;isLeft&&(leftX-=newWidth-width),width=newWidth}else if(currentRatio>ratio){var newHeight=height/(ratio*height/width);isUp&&(topY-=newHeight-height),height=newHeight}if(0>leftX&&(leftX=0),0>topY&&(topY=0),leftX+width>canvas.getWidth()){var newWidth=canvas.getWidth()-leftX;height=newWidth*height/width,width=newWidth,isUp&&(topY=fromY-height)}if(topY+height>canvas.getHeight()){var newHeight=canvas.getHeight()-topY;width=width*newHeight/height,height=newHeight,isLeft&&(leftX=fromX-width)}}this.cropZone.left=leftX,this.cropZone.top=topY,this.cropZone.width=width,this.cropZone.height=height,this.darkroom.canvas.bringToFront(this.cropZone),this.darkroom.dispatchEvent("crop:update")}})}(),function(){"use strict";var Rotation=Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){var angle=(image.getAngle()+this.options.angle)%360;image.rotate(angle);var width,height;height=Math.abs(image.getWidth()*Math.sin(angle*Math.PI/180))+Math.abs(image.getHeight()*Math.cos(angle*Math.PI/180)),width=Math.abs(image.getHeight()*Math.sin(angle*Math.PI/180))+Math.abs(image.getWidth()*Math.cos(angle*Math.PI/180)),canvas.setWidth(width),canvas.setHeight(height),canvas.centerObject(image),image.setCoords(),canvas.renderAll(),next()}});Darkroom.plugins.rotate=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup(),leftButton=buttonGroup.createButton({image:"rotate-left",tooltip:"Rorate left"}),rightButton=buttonGroup.createButton({image:"rotate-right",tooltip:"Rotate right"});leftButton.addEventListener("click",this.rotateLeft.bind(this)),rightButton.addEventListener("click",this.rotateRight.bind(this))},rotateLeft:function(){this.rotate(-90)},rotateRight:function(){this.rotate(90)},rotate:function(angle){this.darkroom.applyTransformation(new Rotation({angle:angle}))}})}(),function(){"use strict";var Grey=Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){var snapshot=new Image;snapshot.onload=function(){var imgInstance=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});image.remove(),canvas.add(imgInstance),next(imgInstance)};var w=canvas.width,h=canvas.height,context=canvas.getContext("2d"),imageData=context.getImageData(0,0,w,h),img_u8=new jsfeat.matrix_t(w,h,jsfeat.U8_t|jsfeat.C1_t);jsfeat.imgproc.grayscale(imageData.data,w,h,img_u8);for(var data_u32=new Uint32Array(imageData.data.buffer),alpha=255<<24,i=img_u8.cols*img_u8.rows,pix=0;--i>=0;)pix=img_u8.data[i],data_u32[i]=alpha|pix<<16|pix<<8|pix;var c=document.createElement("canvas"),wc=c.getContext("2d");c.width=w,c.height=h,wc.putImageData(imageData,0,0),snapshot.src=c.toDataURL()}});Darkroom.plugins.gray=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.greyButton=buttonGroup.createButton({image:"gray",tooltip:"Convert to grayscale"}),this.greyButton.addEventListener("click",this.greyImage.bind(this))},greyImage:function(){this.darkroom.applyTransformation(new Grey)}})}(),function(){"use strict";var Equalize=Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){var snapshot=new Image;snapshot.onload=function(){var imgInstance=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});image.remove(),canvas.add(imgInstance),next(imgInstance)};var w=canvas.width,h=canvas.height,context=canvas.getContext("2d"),imageData=context.getImageData(0,0,w,h),img_u8=new jsfeat.matrix_t(w,h,jsfeat.U8_t|jsfeat.C1_t);jsfeat.imgproc.grayscale(imageData.data,w,h,img_u8),jsfeat.imgproc.equalize_histogram(img_u8,img_u8);for(var data_u32=new Uint32Array(imageData.data.buffer),alpha=255<<24,i=img_u8.cols*img_u8.rows,pix=0;--i>=0;)pix=img_u8.data[i],data_u32[i]=alpha|pix<<16|pix<<8|pix;var c=document.createElement("canvas"),wc=c.getContext("2d");c.width=w,c.height=h,wc.putImageData(imageData,0,0),snapshot.src=c.toDataURL()}});Darkroom.plugins.equalize=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.equalizeButton=buttonGroup.createButton({image:"equalize",tooltip:"Equalize histogram"}),this.equalizeButton.addEventListener("click",this.equalizeImage.bind(this))},equalizeImage:function(){this.darkroom.applyTransformation(new Equalize)}})}(),function(){"use strict";var Blur=Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){var snapshot=new Image;snapshot.onload=function(){var imgInstance=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});image.remove(),canvas.add(imgInstance),next(imgInstance)};var w=canvas.width,h=canvas.height,context=canvas.getContext("2d"),imageData=context.getImageData(0,0,w,h),img_u8=new jsfeat.matrix_t(w,h,jsfeat.U8_t|jsfeat.C1_t);jsfeat.imgproc.grayscale(imageData.data,w,h,img_u8);var r=2,kernel_size=r+1<<1;jsfeat.imgproc.gaussian_blur(img_u8,img_u8,kernel_size,0);for(var data_u32=new Uint32Array(imageData.data.buffer),alpha=255<<24,i=img_u8.cols*img_u8.rows,pix=0;--i>=0;)pix=img_u8.data[i],data_u32[i]=alpha|pix<<16|pix<<8|pix;var c=document.createElement("canvas"),wc=c.getContext("2d");c.width=w,c.height=h,wc.putImageData(imageData,0,0),snapshot.src=c.toDataURL()}});Darkroom.plugins.blur=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.blurButton=buttonGroup.createButton({image:"blur",tooltip:"Gaussian blur"}),this.blurButton.addEventListener("click",this.blurImage.bind(this))},blurImage:function(){this.darkroom.applyTransformation(new Blur)}})}(),function(){"use strict";var Canny=Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){var snapshot=new Image;snapshot.onload=function(){var imgInstance=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});image.remove(),canvas.add(imgInstance),next(imgInstance)};var w=canvas.width,h=canvas.height,context=canvas.getContext("2d"),imageData=context.getImageData(0,0,w,h),img_u8=new jsfeat.matrix_t(w,h,jsfeat.U8_t|jsfeat.C1_t);jsfeat.imgproc.grayscale(imageData.data,w,h,img_u8);var r=2,kernel_size=r+1<<1;jsfeat.imgproc.gaussian_blur(img_u8,img_u8,kernel_size,0),jsfeat.imgproc.canny(img_u8,img_u8,20,50);for(var data_u32=new Uint32Array(imageData.data.buffer),alpha=255<<24,i=img_u8.cols*img_u8.rows,pix=0;--i>=0;)pix=img_u8.data[i],
data_u32[i]=alpha|pix<<16|pix<<8|pix;var c=document.createElement("canvas"),wc=c.getContext("2d");c.width=w,c.height=h,wc.putImageData(imageData,0,0),snapshot.src=c.toDataURL()}});Darkroom.plugins.canny=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.cannyButton=buttonGroup.createButton({image:"canny",tooltip:"Canny edge detection"}),this.cannyButton.addEventListener("click",this.cannyImage.bind(this))},cannyImage:function(){this.darkroom.applyTransformation(new Canny)}})}(),function(){"use strict";var Sobel=Darkroom.Transformation.extend({applyTransformation:function(canvas,image,next){var snapshot=new Image;snapshot.onload=function(){var imgInstance=new fabric.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});image.remove(),canvas.add(imgInstance),next(imgInstance)};var w=canvas.width,h=canvas.height,context=canvas.getContext("2d"),imageData=context.getImageData(0,0,w,h),img_u8=new jsfeat.matrix_t(w,h,jsfeat.U8_t|jsfeat.C1_t),img_gxgy=new jsfeat.matrix_t(w,h,jsfeat.S32C2_t);jsfeat.imgproc.grayscale(imageData.data,w,h,img_u8),jsfeat.imgproc.sobel_derivatives(img_u8,img_gxgy);for(var data_u32=new Uint32Array(imageData.data.buffer),i=img_u8.cols*img_u8.rows,pix=0,gx=0,gy=0;--i>=0;)gx=255&Math.abs(img_gxgy.data[i<<1]>>2),gy=255&Math.abs(img_gxgy.data[(i<<1)+1]>>2),pix=gx+gy>>1&255,data_u32[i]=pix<<24|gx<<16|0|gy;var c=document.createElement("canvas"),wc=c.getContext("2d");c.width=w,c.height=h,wc.putImageData(imageData,0,0),snapshot.src=c.toDataURL()}});Darkroom.plugins.sobel=Darkroom.Plugin.extend({initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.sobelButton=buttonGroup.createButton({image:"sobel",tooltip:"Sobel edge detection"}),this.sobelButton.addEventListener("click",this.sobelImage.bind(this))},sobelImage:function(){this.darkroom.applyTransformation(new Sobel)}})}(),function(){"use strict";Darkroom.plugins.save=Darkroom.Plugin.extend({defaults:{callback:function(){this.darkroom.selfDestroy()}},initialize:function(){var buttonGroup=this.darkroom.toolbar.createButtonGroup();this.destroyButton=buttonGroup.createButton({image:"save",tooltip:"Save and close controls"}),this.destroyButton.addEventListener("click",this.options.callback.bind(this))}})}();